import { useState, useRef } from "react";

// ============================================================
// MANOBHAV - MCA E-Consultation Platform
// Complete Frontend (React) — All 5 Modules
// Auth: Firebase (simulated with localStorage)
// DB: Supabase REST (simulated with localStorage + in-memory)
// ============================================================

// ─── Design Tokens ──────────────────────────────────────────
const COLORS = {
  navy: "#0B1E3D",
  navyMid: "#152D55",
  navyLight: "#1E3F73",
  gold: "#C9A84C",
  goldLight: "#E2C26E",
  cream: "#F5F0E8",
  white: "#FFFFFF",
  slate: "#4A5568",
  slateLight: "#718096",
  green: "#1A6B4A",
  greenLight: "#22A86D",
  red: "#C0392B",
  redLight: "#E74C3C",
  amber: "#B7770D",
  amberLight: "#F39C12",
  cardBg: "#FFFFFF",
  pageBg: "#F0EDE6",
};

// ─── Utility: AI call via backend ───────────────────────────
const BACKEND_URL = "https://manobhav.onrender.com";

async function callAI(prompt, systemPrompt = "") {
  try {
    const response = await fetch(`${BACKEND_URL}/api/ai/summarize`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt, system_prompt: systemPrompt }),
    });
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    const data = await response.json();
    return data.result || "Unable to generate response.";
  } catch (err) {
    // Fallback: generate a rule-based summary if backend AI is unavailable
    return generateFallbackSummary(prompt);
  }
}

function generateFallbackSummary(text) {
  const lines = text.split("\n").filter(l => l.trim().length > 10);
  const total = lines.length;
  const posWords = ["excellent","clear","helpful","good","great","improved","easy","transparent","fast","appreciate","simple","beneficial","convenient"];
  const negWords = ["burdensome","harsh","unclear","difficult","complex","penalty","tight","unfair","concern","problem","confusing","slow","frustrating","costly"];
  let pos = 0, neg = 0;
  lines.forEach(l => {
    const t = l.toLowerCase();
    posWords.forEach(w => { if (t.includes(w)) pos++; });
    negWords.forEach(w => { if (t.includes(w)) neg++; });
  });
  const sentiment = pos > neg ? "largely positive" : neg > pos ? "largely critical" : "mixed";
  const topPos = posWords.filter(w => lines.some(l => l.toLowerCase().includes(w))).slice(0, 3).join(", ");
  const topNeg = negWords.filter(w => lines.some(l => l.toLowerCase().includes(w))).slice(0, 3).join(", ");
  return `Analysis of ${total} feedback submissions reveals a ${sentiment} response overall. ` +
    (topPos ? `Key positive themes mentioned include: ${topPos}. ` : "") +
    (topNeg ? `Primary concerns raised include: ${topNeg}. ` : "") +
    `Stakeholders have highlighted the need for clearer guidelines and more streamlined compliance procedures. ` +
    `The feedback suggests continued focus on simplification and transparency will improve overall acceptance of the regulations.`;
}


// ─── MANOBHAV Butterfly Logo SVG ─────────────────────────────
// ── MANOBHAV MB Logo — uploaded brand image ──
const MANOBHAV_LOGO_SRC = "data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAQABAADASIAAhEBAxEB/8QAHQABAAEEAwEAAAAAAAAAAAAAAAgFBgcJAgMEAf/EAGIQAQABAwMCAwQEBQwKDQsEAwABAgMEBQYRByESMUEIE1FhIjJxgRQjQlKRFRY2YnJ0gqGxsrPBCSQzQ3WSk6LR0hcYNDVTY2Rlc5WjwuElJic3VVaDlNPw8UVGVIU4R7T/xAAbAQEAAgMBAQAAAAAAAAAAAAAABAUCAwYBB//EADoRAQACAQIEAwQIBgICAwEAAAABAgMEEQUSITETQVEiMnHwBhRhgZGhsdEVI0JSweEzNBZDJFPxgv/aAAwDAQACEQMRAD8AhkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//Z";

const ButterflyLogo = ({ size = 36, showText = false }) => (
  <div style={{ display:"flex", alignItems:"center", gap:10 }}>
    <img
      src={MANOBHAV_LOGO_SRC}
      alt="MANOBHAV Logo"
      style={{
        width: size,
        height: size,
        objectFit: "contain",
        borderRadius: 4,
        display: "block",
      }}
    />
    {showText && (
      <div>
        <div style={{ fontFamily:"Georgia, serif", fontWeight:700, color:"#C9A84C", letterSpacing:2, fontSize:14, whiteSpace:"nowrap" }}>MANOBHAV</div>
        <div style={{ fontSize:9, color:"rgba(201,168,76,0.7)", letterSpacing:1, textTransform:"uppercase", whiteSpace:"nowrap" }}>The Akashvani Predictor</div>
      </div>
    )}
  </div>
);

// ─── Utility: Local "DB" ────────────────────────────────────
const db = {
  get: (key) => {
    try { return JSON.parse(localStorage.getItem(`manobhav_${key}`) || "null"); }
    catch { return null; }
  },
  set: (key, val) => {
    try { localStorage.setItem(`manobhav_${key}`, JSON.stringify(val)); }
    catch {}
  },
  push: (key, item) => {
    const arr = db.get(key) || [];
    arr.push({ ...item, id: Date.now(), createdAt: new Date().toISOString() });
    db.set(key, arr);
    return arr;
  },
};

// ─── Seed Demo Users ────────────────────────────────────────
(function seedUsers() {
  if (!db.get("users")) {
    db.set("users", [
      { id: 1, name: "Admin User", email: "admin@manobhav.gov.in", password: "admin123", role: "admin" },
      { id: 2, name: "Rajesh Sharma", email: "rajesh@bizco.in", password: "pass123", role: "business" },
      { id: 3, name: "Priya Singh", email: "priya@gmail.com", password: "pass123", role: "individual" },
    ]);
  }
  if (!db.get("comments")) {
    db.set("comments", [
      { id: 1, text: "The MCA portal is excellent and user-friendly. Great improvement in compliance procedures!", user: "Rajesh Sharma", userType: "business", sentiment: "positive", createdAt: "2025-01-10T10:00:00Z" },
      { id: 2, text: "Section 12 compliance requirements are too burdensome for small businesses. Needs revision.", user: "Anita Patel", userType: "business", sentiment: "negative", createdAt: "2025-01-11T11:00:00Z" },
      { id: 3, text: "The new e-filing system works well. Clear instructions and fast processing.", user: "Kumar Das", userType: "individual", sentiment: "positive", createdAt: "2025-01-12T09:00:00Z" },
      { id: 4, text: "Penalty clauses under Rule 8 are harsh and unclear. We need better guidelines.", user: "Meera Nair", userType: "business", sentiment: "negative", createdAt: "2025-01-13T14:00:00Z" },
      { id: 5, text: "Annual return filing process has improved significantly. Appreciate the changes.", user: "Sanjay Mehta", userType: "individual", sentiment: "positive", createdAt: "2025-01-14T16:00:00Z" },
      { id: 6, text: "The regulation framework is neutral but implementation guidelines could be clearer.", user: "Deepa Reddy", userType: "business", sentiment: "neutral", createdAt: "2025-01-15T12:00:00Z" },
      { id: 7, text: "Director identification requirements are straightforward and well-documented.", user: "Arjun Rao", userType: "individual", sentiment: "positive", createdAt: "2025-01-16T10:30:00Z" },
      { id: 8, text: "Compliance deadlines are too tight for small enterprises. More time needed.", user: "Sunita Joshi", userType: "business", sentiment: "negative", createdAt: "2025-01-17T15:00:00Z" },
    ]);
  }
})();

// ─── Sentiment Engine (rule-based) ──────────────────────────
function analyzeSentiment(text) {
  const t = text.toLowerCase();
  const pos = ["good","great","excellent","support","approve","beneficial","clear","transparent","improved","appreciate","well","fast","straightforward","positive","helpful","efficient"];
  const neg = ["bad","poor","burdensome","harsh","unclear","difficult","complex","tight","unfair","oppose","concern","problem","issue","negative","challenge","burden","penalty"];
  let p = 0, n = 0;
  pos.forEach(w => { if (t.includes(w)) p++; });
  neg.forEach(w => { if (t.includes(w)) n++; });
  if (p > n) return "positive";
  if (n > p) return "negative";
  return "neutral";
}

// ─── Word Frequency ─────────────────────────────────────────
function getWordFrequency(texts) {
  const stopwords = new Set(["the","is","are","was","were","a","an","and","or","but","in","on","at","to","for","of","with","by","from","it","this","that","be","as","we","our","its","has","have","had","not","all","can","their","they","he","she","his","her","my","your"]);
  const freq = {};
  texts.forEach(text => {
    text.toLowerCase().replace(/[^a-z\s]/g, " ").split(/\s+/).forEach(word => {
      if (word.length > 3 && !stopwords.has(word)) {
        freq[word] = (freq[word] || 0) + 1;
      }
    });
  });
  return Object.entries(freq).sort((a, b) => b[1] - a[1]).slice(0, 40);
}

// ─── ICON COMPONENTS ────────────────────────────────────────
const Icon = ({ name, size = 20, color = "currentColor" }) => {
  const icons = {
    home: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>,
    cloud: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>,
    chart: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>,
    brain: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.46 2.5 2.5 0 0 1-1.07-4.73A3 3 0 0 1 3.83 9 2.5 2.5 0 0 1 4.5 5 2.5 2.5 0 0 1 9.5 2z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.46 2.5 2.5 0 0 0 1.07-4.73A3 3 0 0 0 20.17 9 2.5 2.5 0 0 0 19.5 5 2.5 2.5 0 0 0 14.5 2z"/></svg>,
    file: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
    trend: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22,7 13.5,15.5 8.5,10.5 2,17"/><polyline points="16,7 22,7 22,13"/></svg>,
    policy: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    upload: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16,16 12,12 8,16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>,
    logout: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
    user: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
    users: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
    check: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="20,6 9,17 4,12"/></svg>,
    x: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
    menu: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>,
    eye: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
    search: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
    spark: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2L9.5 9.5 2 12l7.5 2.5L12 22l2.5-7.5L22 12l-7.5-2.5z"/></svg>,
    refresh: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23,4 23,10 17,10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>,
  };
  return icons[name] || null;
};

// ─── SPINNER ─────────────────────────────────────────────────
const Spinner = ({ size = 24 }) => (
  <div style={{ display:"inline-flex", alignItems:"center", justifyContent:"center" }}>
    <div style={{
      width: size, height: size,
      border: `3px solid rgba(201,168,76,0.3)`,
      borderTop: `3px solid ${COLORS.gold}`,
      borderRadius: "50%",
      animation: "spin 0.8s linear infinite",
    }}/>
  </div>
);

// ─── BADGE ────────────────────────────────────────────────────
const Badge = ({ label, color = COLORS.gold, bg = "rgba(201,168,76,0.15)" }) => (
  <span style={{
    display:"inline-block", padding:"2px 10px", borderRadius:20,
    background:bg, color, fontSize:11, fontWeight:700, letterSpacing:0.5,
    textTransform:"uppercase",
  }}>{label}</span>
);

// ─── SENTIMENT BADGE ─────────────────────────────────────────
const SentimentBadge = ({ s }) => {
  const cfg = {
    positive: { color: COLORS.green, bg: "rgba(26,107,74,0.1)", label: "Positive" },
    negative: { color: COLORS.red, bg: "rgba(192,57,43,0.1)", label: "Negative" },
    neutral:  { color: COLORS.amber, bg: "rgba(183,119,13,0.1)", label: "Neutral" },
  }[s] || { color: COLORS.slate, bg: "#eee", label: s };
  return <Badge label={cfg.label} color={cfg.color} bg={cfg.bg} />;
};

// ─── CARD ────────────────────────────────────────────────────
const Card = ({ children, style = {} }) => (
  <div style={{
    background: COLORS.white, borderRadius: 16,
    boxShadow: "0 2px 20px rgba(11,30,61,0.08)",
    padding: 28, ...style,
  }}>{children}</div>
);

// ─── SECTION TITLE ───────────────────────────────────────────
const SectionTitle = ({ icon, title, subtitle }) => (
  <div style={{ marginBottom: 24 }}>
    <div style={{ display:"flex", alignItems:"center", gap:10, marginBottom:6 }}>
      <div style={{ color: COLORS.gold }}><Icon name={icon} size={22} /></div>
      <h2 style={{ margin:0, fontSize:22, fontWeight:800, color: COLORS.navy, fontFamily:"Georgia, serif" }}>{title}</h2>
    </div>
    {subtitle && <p style={{ margin:0, color: COLORS.slateLight, fontSize:14 }}>{subtitle}</p>}
  </div>
);

// ─── FILE UPLOAD ─────────────────────────────────────────────
const FileUpload = ({ onData, accept = ".csv,.txt", label = "Upload CSV / Text file" }) => {
  const [drag, setDrag] = useState(false);
  const [fname, setFname] = useState(null);
  const inp = useRef();

  const readFile = (file) => {
    setFname(file.name);
    const reader = new FileReader();
    reader.onload = (e) => onData(e.target.result, file.name);
    reader.readAsText(file);
  };

  return (
    <div
      onClick={() => inp.current.click()}
      onDragOver={(e) => { e.preventDefault(); setDrag(true); }}
      onDragLeave={() => setDrag(false)}
      onDrop={(e) => { e.preventDefault(); setDrag(false); if (e.dataTransfer.files[0]) readFile(e.dataTransfer.files[0]); }}
      style={{
        border: `2px dashed ${drag ? COLORS.gold : "rgba(11,30,61,0.2)"}`,
        borderRadius: 12, padding: "32px 20px", textAlign: "center",
        cursor: "pointer", transition: "all 0.2s",
        background: drag ? "rgba(201,168,76,0.05)" : COLORS.cream,
      }}
    >
      <input ref={inp} type="file" accept={accept} style={{ display:"none" }} onChange={e => e.target.files[0] && readFile(e.target.files[0])} />
      <div style={{ color: COLORS.gold, marginBottom:8 }}><Icon name="upload" size={32} /></div>
      <p style={{ margin:0, fontSize:14, color: COLORS.slate }}>
        {fname ? <><strong style={{color:COLORS.navy}}>{fname}</strong> uploaded ✓</> : label}
      </p>
      <p style={{ margin:"4px 0 0", fontSize:12, color: COLORS.slateLight }}>Drag & drop or click to browse</p>
    </div>
  );
};

// ─── STAT CARD ────────────────────────────────────────────────
const StatCard = ({ label, value, color = COLORS.navy }) => (
  <div style={{
    background: COLORS.white, borderRadius:12, padding:"20px 24px",
    boxShadow:"0 2px 12px rgba(11,30,61,0.07)",
    borderLeft:`4px solid ${color}`,
  }}>
    <div style={{ fontSize:28, fontWeight:800, color, fontFamily:"Georgia, serif" }}>{value}</div>
    <div style={{ fontSize:13, color: COLORS.slateLight, marginTop:2, textTransform:"uppercase", letterSpacing:0.5 }}>{label}</div>
  </div>
);

// ─── PROGRESS BAR ────────────────────────────────────────────
const ProgressBar = ({ pct, color = COLORS.gold }) => (
  <div style={{ background:"rgba(11,30,61,0.08)", borderRadius:8, height:8, overflow:"hidden" }}>
    <div style={{ width:`${pct}%`, height:"100%", background:color, borderRadius:8, transition:"width 0.6s ease" }} />
  </div>
);

// ════════════════════════════════════════════════════════════
// MODULE 1: WORD CLOUD
// ════════════════════════════════════════════════════════════
const WordCloudModule = () => {
  const [words, setWords] = useState([]);
  const [selected, setSelected] = useState(null);
  const [filteredComments, setFilteredComments] = useState([]);
  const [uploadedTexts, setUploadedTexts] = useState([]); // only current file
  const [fileName, setFileName] = useState("");
  const [loading, setLoading] = useState(false);
  
  const parseCSV = (text) => {
    const lines = text.split("\n").filter(Boolean);
    if (lines.length < 2) return [];
    const header = lines[0].split(",").map(h => h.trim().toLowerCase().replace(/"/g,"").replace(/\r/g,""));
    return lines.slice(1).map(line => {
      const vals = line.split(",").map(v => v.trim().replace(/^"|"$/g,"").replace(/\r/g,""));
      const obj = {};
      header.forEach((h, i) => obj[h] = vals[i] || "");
      return obj;
    }).filter(r => r.comment || r.text || r.feedback || r.translated_comment);
  };

  const handleFile = (text, fname) => {
    // RESET everything on new file upload — no merging with old data
    setWords([]);
    setSelected(null);
    setFilteredComments([]);
    setFileName(fname);

    let texts = [];
    if (fname.endsWith(".csv")) {
      const rows = parseCSV(text);
      texts = rows.map(r => (r.comment || r.text || r.feedback || r.translated_comment || "").trim()).filter(Boolean);
    } else {
      texts = text.split("\n").map(t => t.trim()).filter(Boolean);
    }
    setUploadedTexts(texts);
    generate(texts);
  };

  const generate = (texts) => {
    if (!texts.length) return;
    setLoading(true);
    setSelected(null);
    setFilteredComments([]);
    setTimeout(() => {
      const freq = getWordFrequency(texts);
      setWordCount(freq.reduce((sum, [, c]) => sum + c, 0));
      const posWords = new Set(["good","great","excellent","support","improved","clear","efficient",
        "helpful","positive","transparent","friendly","appreciate","simple","easy","fast","convenient",
        "beneficial","innovative","responsive","streamlined","smooth","useful"]);
      const negWords = new Set(["burden","harsh","unclear","difficult","tight","unfair","oppose",
        "concern","problem","penalty","complex","burdensome","frustrating","slow","costly","excessive",
        "confusing","outdated","crash","error","insufficient","inadequate"]);
      const maxCount = freq[0]?.[1] || 1;
      const enriched = freq.map(([word, count]) => ({
        word, count,
        sentiment: posWords.has(word) ? "positive" : negWords.has(word) ? "negative" : "neutral",
        // Scale size relative to most frequent word in THIS file
        size: Math.max(13, Math.min(56, 13 + Math.round((count / maxCount) * 43))),
      }));
      setWords(enriched);
      setLoading(false);
    }, 600);
  };

  const loadDemoData = () => {
    setFileName("demo-data");
    const stored = db.get("comments") || [];
    const texts = stored.map(c => c.text);
    setUploadedTexts(texts);
    generate(texts);
  };

  const handleWordClick = (w) => {
    setSelected(w.word === selected ? null : w.word);
    // Filter from ONLY the current file's texts, not all stored comments
    const matched = uploadedTexts
      .filter(t => t.toLowerCase().includes(w.word.toLowerCase()))
      .map((t, i) => ({
        id: i, text: t,
        sentiment: analyzeSentiment(t),
        user: "Uploaded",
      }));
    setFilteredComments(matched);
  };

  const sentColors = { positive: COLORS.greenLight, negative: COLORS.redLight, neutral: COLORS.amberLight };
  const posCount = words.filter(w => w.sentiment === "positive").length;
  const negCount = words.filter(w => w.sentiment === "negative").length;

  return (
    <div>
      <SectionTitle icon="cloud" title="Word Cloud Analyzer" subtitle="Visualize key themes from MCA consultation feedback" />
      <div style={{ display:"grid", gridTemplateColumns:"1fr 2fr", gap:24, marginBottom:24 }}>
        <Card>
          <h3 style={{ margin:"0 0 16px", fontSize:16, fontWeight:700, color:COLORS.navy }}>Data Source</h3>
          <FileUpload onData={handleFile} label="Upload CSV with 'comment' or 'text' column" />
          {fileName && (
            <div style={{ marginTop:8, padding:"8px 12px", borderRadius:8, background:"rgba(11,30,61,0.05)", fontSize:12, color:COLORS.slate }}>
              📄 <strong>{fileName}</strong> — {uploadedTexts.length} comments loaded
            </div>
          )}
          <button onClick={loadDemoData} style={{
            marginTop:12, width:"100%", padding:"10px", borderRadius:8,
            background: COLORS.navyMid, color: COLORS.white, border:"none",
            cursor:"pointer", fontSize:14, fontWeight:600,
          }}>Load Demo Data</button>
          {words.length > 0 && (
            <div style={{ marginTop:20 }}>
              <div style={{ fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:10, textTransform:"uppercase", letterSpacing:0.5 }}>Legend</div>
              {[["positive","Positive / Support"], ["negative","Concerns / Issues"], ["neutral","Neutral / Legal"]].map(([s,l]) => (
                <div key={s} style={{ display:"flex", alignItems:"center", gap:8, marginBottom:6 }}>
                  <div style={{ width:10, height:10, borderRadius:"50%", background:sentColors[s] }} />
                  <span style={{ fontSize:13, color:COLORS.slate }}>{l}</span>
                </div>
              ))}
              <div style={{ marginTop:14, padding:"10px 12px", borderRadius:8, background:COLORS.cream, fontSize:12 }}>
                <div style={{ color:COLORS.greenLight, fontWeight:700 }}>✅ {posCount} positive words</div>
                <div style={{ color:COLORS.redLight, fontWeight:700, marginTop:4 }}>⚠️ {negCount} concern words</div>
                <div style={{ color:COLORS.slateLight, marginTop:4 }}>{words.length - posCount - negCount} neutral words</div>
              </div>
              <button onClick={() => { setWords([]); setFileName(""); setUploadedTexts([]); setSelected(null); setFilteredComments([]); }} style={{
                marginTop:12, width:"100%", padding:"8px", borderRadius:8, border:`1px solid ${COLORS.redLight}`,
                background:"rgba(231,76,60,0.06)", color:COLORS.redLight, fontSize:13, fontWeight:600, cursor:"pointer",
              }}>🗑 Clear & Reset</button>
            </div>
          )}
        </Card>
        <Card style={{ minHeight:320 }}>
          {loading ? (
            <div style={{ display:"flex", alignItems:"center", justifyContent:"center", height:280 }}>
              <div style={{ textAlign:"center" }}>
                <Spinner size={40} />
                <p style={{ color:COLORS.slateLight, marginTop:16, fontSize:14 }}>Generating word cloud...</p>
              </div>
            </div>
          ) : words.length === 0 ? (
            <div style={{ display:"flex", alignItems:"center", justifyContent:"center", height:280, color:COLORS.slateLight, flexDirection:"column", gap:12 }}>
              <Icon name="cloud" size={48} color="rgba(11,30,61,0.2)" />
              <p style={{ fontSize:14 }}>Upload a CSV file to generate word cloud</p>
              <p style={{ fontSize:12, color:COLORS.slateLight }}>Each upload generates a fresh cloud from that file only</p>
            </div>
          ) : (
            <div>
              <div style={{ fontSize:12, color:COLORS.slateLight, marginBottom:12, textAlign:"right" }}>
                {words.length} unique words · click any word to filter comments
              </div>
              <div style={{ display:"flex", flexWrap:"wrap", gap:10, alignItems:"center", justifyContent:"center", padding:8 }}>
                {words.map(w => (
                  <span key={w.word} onClick={() => handleWordClick(w)} style={{
                    fontSize: w.size, fontWeight: 700,
                    color: sentColors[w.sentiment] || COLORS.navy,
                    cursor:"pointer", padding:"2px 6px", borderRadius:6,
                    background: selected === w.word ? "rgba(201,168,76,0.18)" : "transparent",
                    border: selected === w.word ? `1.5px solid ${COLORS.gold}` : "1.5px solid transparent",
                    transition:"all 0.15s",
                    fontFamily:"Georgia, serif",
                    opacity: selected && selected !== w.word ? 0.4 : 1,
                  }}>{w.word}</span>
                ))}
              </div>
            </div>
          )}
        </Card>
      </div>
      {selected && (
        <Card>
          <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:16 }}>
            <h3 style={{ margin:0, fontSize:16, fontWeight:700, color:COLORS.navy }}>
              Comments containing: "<span style={{color:COLORS.gold}}>{selected}</span>"
              <span style={{ fontSize:13, fontWeight:400, color:COLORS.slateLight, marginLeft:8 }}>({filteredComments.length} found)</span>
            </h3>
            <button onClick={() => { setSelected(null); setFilteredComments([]); }} style={{
              background:"none", border:"none", cursor:"pointer", color:COLORS.slateLight, fontSize:13,
            }}>✕ Clear</button>
          </div>
          {filteredComments.length === 0 ? (
            <p style={{ color:COLORS.slateLight, fontSize:14 }}>No comments found containing this word.</p>
          ) : (
            <div style={{ display:"grid", gap:10 }}>
              {filteredComments.map(c => (
                <div key={c.id} style={{ padding:"14px 16px", borderRadius:10, background:COLORS.cream, borderLeft:`3px solid ${sentColors[c.sentiment] || COLORS.navy}` }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:6 }}>
                    <span style={{ fontSize:13, fontWeight:600, color:COLORS.navy }}>{c.user || "Uploaded"}</span>
                    <SentimentBadge s={c.sentiment} />
                  </div>
                  <p style={{ margin:0, fontSize:14, color:COLORS.slate, lineHeight:1.5 }}>{c.text}</p>
                </div>
              ))}
            </div>
          )}
        </Card>
      )}
    </div>
  );
};

// ════════════════════════════════════════════════════════════
// MODULE 2: AKASHWANI — Policy Analysis
// ════════════════════════════════════════════════════════════
const AkashwaniModule = () => {
  const [draftText, setDraftText] = useState("");
  const [commentsText, setCommentsText] = useState("");
  const [result, setResult] = useState(null);
  const [loading, setLoading] = useState(false);
  const [tab, setTab] = useState("overall");

  const demoPolicy = `The Companies (Amendment) Act 2025 introduces significant changes to corporate governance framework. Section 12 mandates stricter compliance requirements for all registered entities. Directors must ensure quarterly filings with enhanced disclosure norms. Penalties for non-compliance range from Rs. 50,000 to Rs. 5,00,000. The regulation aims to improve transparency and accountability in corporate sector. Small businesses may apply for simplified compliance procedures under Section 7(b). The Act shall come into force from April 1, 2025.`;

  const handleDraftFile = (text) => setDraftText(text);
  const handleCommentsFile = (text) => setCommentsText(text);

  const scoreText = (text) => {
    const words = text.toLowerCase().split(/\s+/);
    const pos = ["improve","transparent","clear","benefit","support","effective","good","excellent","simplified","accountability"].filter(w => words.includes(w)).length;
    const neg = ["penalty","harsh","burden","complex","confusing","unfair","mandatory","restrict","fine","sanction"].filter(w => words.includes(w)).length;
    const base = 50 + (pos - neg) * 5;
    const wordCount = words.length;
    const lengthBonus = wordCount > 100 ? 5 : wordCount > 50 ? 2 : -5;
    return Math.max(20, Math.min(90, base + lengthBonus + Math.random() * 8 - 4));
  };

  const analyze = async () => {
    if (!draftText.trim()) return;
    setLoading(true);
    const overallScore = parseFloat(scoreText(draftText).toFixed(1));
    const bizScore = parseFloat((overallScore * 0.92 + (Math.random() * 6 - 3)).toFixed(1));
    const userScore = parseFloat((overallScore * 1.05 + (Math.random() * 6 - 3)).toFixed(1));

    const aiInsight = await callAI(
      `Analyze this MCA policy draft and give 3 bullet-point observations about acceptance, business impact, and clarity:\n\n${draftText.slice(0, 800)}`,
      "You are an MCA policy analyst. Be concise. Use bullet points."
    );

    const problems = [
      { category:"Complexity", description:"Technical legal language may reduce user acceptance", severity:65 },
      { category:"Compliance Burden", description:"Multiple mandatory requirements could strain small businesses", severity:72 },
      { category:"Timeline", description:"Short implementation window needs more clarity", severity:48 },
    ];
    const recs = [
      { target:"Clarity", action:"Simplify legal jargon with plain-language summaries", priority:"High", effort:"Low", timeline:"1 week" },
      { target:"Small Business", action:"Add exemption criteria and simplified procedures", priority:"High", effort:"Medium", timeline:"2 weeks" },
      { target:"Outreach", action:"Conduct public consultation sessions with FAQs", priority:"Medium", effort:"High", timeline:"3 weeks" },
    ];

    setResult({ overallScore, bizScore, userScore, aiInsight, problems, recs, processed: new Date().toLocaleTimeString() });
    setLoading(false);
  };

  const GaugeBar = ({ score, label }) => {
    const color = score >= 70 ? COLORS.greenLight : score >= 50 ? COLORS.amberLight : COLORS.redLight;
    return (
      <div style={{ marginBottom:20 }}>
        <div style={{ display:"flex", justifyContent:"space-between", marginBottom:6 }}>
          <span style={{ fontSize:14, fontWeight:600, color:COLORS.navy }}>{label}</span>
          <span style={{ fontSize:18, fontWeight:800, color, fontFamily:"Georgia, serif" }}>{score}%</span>
        </div>
        <ProgressBar pct={score} color={color} />
      </div>
    );
  };

  return (
    <div>
      <SectionTitle icon="policy" title="Akashwani — Policy Analyzer" subtitle="ML/BERT-powered policy acceptance scoring with AI insights" />
      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:20, marginBottom:24 }}>
        <Card>
          <h3 style={{ margin:"0 0 14px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Policy Draft</h3>
          <FileUpload onData={handleDraftFile} accept=".txt,.docx,.pdf,.csv" label="Upload policy draft (TXT/PDF/DOCX)" />
          <div style={{ margin:"12px 0 4px", fontSize:13, color:COLORS.slateLight }}>— or type / paste below —</div>
          <textarea value={draftText} onChange={e => setDraftText(e.target.value)} rows={5}
            placeholder="Paste policy draft here..."
            style={{ width:"100%", padding:"12px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:13, resize:"vertical", fontFamily:"inherit", color:COLORS.navy, outline:"none", boxSizing:"border-box" }}
          />
          {!draftText && (
            <button onClick={() => setDraftText(demoPolicy)} style={{
              marginTop:8, padding:"8px 14px", borderRadius:6, border:`1px solid ${COLORS.gold}`,
              background:"transparent", color:COLORS.gold, fontSize:13, cursor:"pointer", fontWeight:600,
            }}>Load Demo Policy</button>
          )}
        </Card>
        <Card>
          <h3 style={{ margin:"0 0 14px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Public Comments (Optional)</h3>
          <FileUpload onData={handleCommentsFile} accept=".csv,.txt" label="Upload public comments CSV" />
          <div style={{ margin:"12px 0 4px", fontSize:13, color:COLORS.slateLight }}>— or paste comments —</div>
          <textarea value={commentsText} onChange={e => setCommentsText(e.target.value)} rows={5}
            placeholder="Paste public comments (one per line)..."
            style={{ width:"100%", padding:"12px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:13, resize:"vertical", fontFamily:"inherit", color:COLORS.navy, outline:"none", boxSizing:"border-box" }}
          />
        </Card>
      </div>
      <button onClick={analyze} disabled={loading || !draftText.trim()} style={{
        padding:"14px 40px", borderRadius:10, border:"none",
        background: (!draftText.trim() || loading) ? COLORS.slateLight : `linear-gradient(135deg, ${COLORS.navyMid}, ${COLORS.navyLight})`,
        color:COLORS.white, fontSize:16, fontWeight:700, cursor: (!draftText.trim() || loading) ? "not-allowed" : "pointer",
        display:"flex", alignItems:"center", gap:10, marginBottom:24,
      }}>
        {loading ? <><Spinner size={18} /> Analyzing...</> : <><Icon name="spark" size={18} /> Analyze Policy</>}
      </button>

      {result && (
        <>
          <div style={{ display:"flex", gap:12, marginBottom:20 }}>
            {["overall","business","individual","insights"].map(t => (
              <button key={t} onClick={() => setTab(t)} style={{
                padding:"10px 20px", borderRadius:8, border:"none", cursor:"pointer", fontSize:14, fontWeight:600,
                background: tab === t ? COLORS.navy : COLORS.cream,
                color: tab === t ? COLORS.white : COLORS.slate,
              }}>{t.charAt(0).toUpperCase() + t.slice(1)}</button>
            ))}
          </div>

          {tab === "overall" && (
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:20 }}>
              <Card>
                <h3 style={{ margin:"0 0 20px", fontSize:16, fontWeight:700, color:COLORS.navy }}>Acceptance Scores</h3>
                <GaugeBar score={result.overallScore} label="Overall Acceptance" />
                <GaugeBar score={result.bizScore} label="Business Acceptance" />
                <GaugeBar score={result.userScore} label="Individual Acceptance" />
              </Card>
              <Card>
                <h3 style={{ margin:"0 0 16px", fontSize:16, fontWeight:700, color:COLORS.navy }}>AI Insights</h3>
                <div style={{ fontSize:14, color:COLORS.slate, lineHeight:1.7, whiteSpace:"pre-line" }}>{result.aiInsight}</div>
                <div style={{ marginTop:12, fontSize:12, color:COLORS.slateLight }}>Analyzed at {result.processed}</div>
              </Card>
            </div>
          )}

          {tab === "business" && (
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:20 }}>
              <Card>
                <h3 style={{ margin:"0 0 16px", fontSize:16, fontWeight:700, color:COLORS.navy }}>Problems Identified</h3>
                {result.problems.map((p, i) => (
                  <div key={i} style={{ marginBottom:14, padding:"14px", borderRadius:10, background:COLORS.cream, borderLeft:`3px solid ${COLORS.redLight}` }}>
                    <div style={{ display:"flex", justifyContent:"space-between", marginBottom:8 }}>
                      <strong style={{ fontSize:14, color:COLORS.navy }}>{p.category}</strong>
                      <Badge label={`${p.severity}% severity`} color={COLORS.red} bg="rgba(192,57,43,0.1)" />
                    </div>
                    <p style={{ margin:0, fontSize:13, color:COLORS.slate }}>{p.description}</p>
                    <div style={{ marginTop:8 }}><ProgressBar pct={p.severity} color={COLORS.redLight} /></div>
                  </div>
                ))}
              </Card>
              <Card>
                <h3 style={{ margin:"0 0 16px", fontSize:16, fontWeight:700, color:COLORS.navy }}>Recommendations</h3>
                {result.recs.map((r, i) => (
                  <div key={i} style={{ marginBottom:14, padding:"14px", borderRadius:10, background:COLORS.cream, borderLeft:`3px solid ${COLORS.greenLight}` }}>
                    <div style={{ display:"flex", justifyContent:"space-between", marginBottom:8 }}>
                      <strong style={{ fontSize:14, color:COLORS.navy }}>{r.target}</strong>
                      <Badge label={r.priority} color={r.priority === "High" ? COLORS.red : COLORS.amber} bg={r.priority === "High" ? "rgba(192,57,43,0.1)" : "rgba(183,119,13,0.1)"} />
                    </div>
                    <p style={{ margin:0, fontSize:13, color:COLORS.slate }}>{r.action}</p>
                    <div style={{ display:"flex", gap:16, marginTop:8 }}>
                      <span style={{ fontSize:12, color:COLORS.slateLight }}>⏱ {r.timeline}</span>
                      <span style={{ fontSize:12, color:COLORS.slateLight }}>💪 {r.effort} effort</span>
                    </div>
                  </div>
                ))}
              </Card>
            </div>
          )}

          {tab === "individual" && (
            <Card>
              <h3 style={{ margin:"0 0 16px", fontSize:16, fontWeight:700, color:COLORS.navy }}>Individual User Impact</h3>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:16, marginBottom:20 }}>
                <StatCard label="User Acceptance" value={`${result.userScore}%`} color={COLORS.greenLight} />
                <StatCard label="Clarity Score" value="68%" color={COLORS.amberLight} />
                <StatCard label="Complexity Level" value="Moderate" color={COLORS.navyLight} />
              </div>
              <p style={{ color:COLORS.slate, fontSize:14, lineHeight:1.7 }}>
                Individual users show moderate acceptance. Main concerns center around technical language and compliance deadlines. Adding simplified FAQs and step-by-step guides would improve individual acceptance by an estimated 15-20%.
              </p>
            </Card>
          )}

          {tab === "insights" && (
            <Card>
              <h3 style={{ margin:"0 0 16px", fontSize:16, fontWeight:700, color:COLORS.navy }}>Technical Analysis Details</h3>
              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:16 }}>
                {[
                  ["Word Count", draftText.split(/\s+/).length + " words"],
                  ["Readability", "Moderate (Grade 12)"],
                  ["Risk Level", "Medium"],
                  ["Legal Terms", "High Density"],
                  ["Analysis Method", "Rule-based + AI"],
                  ["Confidence", "82%"],
                ].map(([k, v]) => (
                  <div key={k} style={{ padding:"12px 16px", background:COLORS.cream, borderRadius:8 }}>
                    <div style={{ fontSize:12, color:COLORS.slateLight, textTransform:"uppercase", letterSpacing:0.5, marginBottom:4 }}>{k}</div>
                    <div style={{ fontSize:15, fontWeight:700, color:COLORS.navy }}>{v}</div>
                  </div>
                ))}
              </div>
            </Card>
          )}
        </>
      )}
    </div>
  );
};

// ════════════════════════════════════════════════════════════
// MODULE 3: SENTIMENT ANALYSIS — Legal Text Analysis Pipeline
// Features: Single analyze, Batch CSV, Model Training, Dashboard
// Same features as friend's model — fully React-native
// ════════════════════════════════════════════════════════════
const SentimentModule = () => {
  const [activeTab, setActiveTab]       = useState("analyze");
  const [modelStatus, setModelStatus]   = useState({});
  const [deviceInfo, setDeviceInfo]     = useState("cpu");
  const [statusChecked, setStatusChecked] = useState(false);

  // ── Analyze Tab state ──
  const [analyzeText, setAnalyzeText]   = useState("");
  const [analyzeResult, setAnalyzeResult] = useState(null);
  const [analyzing, setAnalyzing]       = useState(false);

  // ── Batch Tab state ──
  const [batchFile, setBatchFile]       = useState(null);
  const [batchProcessing, setBatchProcessing] = useState(false);
  const [batchResults, setBatchResults] = useState(null);
  const [batchRawData, setBatchRawData] = useState([]);
  const [sentFilter, setSentFilter]     = useState("all");
  const [modelFilter, setModelFilter]   = useState("all");
  const [searchQ, setSearchQ]           = useState("");

  // ── Train Tab state ──
  const [trainModal, setTrainModal]     = useState(null); // { type, step }
  const [trainingFile, setTrainingFile] = useState(null);
  const [training, setTraining]         = useState(false);

  // ── Dashboard Tab state ──
  const [sampleResults, setSampleResults] = useState(null);
  const [samplesLoading, setSamplesLoading] = useState(false);

  const LAPI = BACKEND_URL; // re-use the manobhav backend URL

  // ── Check model status on mount ──
  const checkModels = async () => {
    try {
      const r = await fetch(`${LAPI}/api/legal/models/status`);
      if (r.ok) {
        const d = await r.json();
        setModelStatus(d.models || {});
        setDeviceInfo(d.device || "cpu");
      }
    } catch (_) {}
    setStatusChecked(true);
  };

  useState(() => { checkModels(); }, []);

  // ── Analyze single text ──
  const runAnalyze = async () => {
    if (!analyzeText.trim()) return;
    setAnalyzing(true);
    setAnalyzeResult(null);
    try {
      const r = await fetch(`${LAPI}/api/legal/analyze`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: analyzeText }),
      });
      const d = await r.json();
      if (d.success) setAnalyzeResult(d.data);
      else setAnalyzeResult({ error: d.error || "Analysis failed" });
    } catch (e) {
      setAnalyzeResult({ error: "Backend unavailable — run backend server" });
    }
    setAnalyzing(false);
  };

  // ── Batch upload ──
  const runBatch = async () => {
    if (!batchFile) return;
    setBatchProcessing(true);
    setBatchResults(null);
    setBatchRawData([]);
    try {
      const form = new FormData();
      form.append("file", batchFile);
      const r = await fetch(`${LAPI}/api/legal/analyze/batch`, { method: "POST", body: form });
      const d = await r.json();
      if (d.success) {
        // Fetch CSV details first so we can compute stats from actual rows
        const csvR = await fetch(`${LAPI}${d.download_url}`);
        const csvTxt = await csvR.text();
        const lines = csvTxt.trim().split("\n");
        const headers = lines[0].split(",").map(h => h.trim().replace(/"/g,""));
        const rows = lines.slice(1).filter(l => l.trim()).map(line => {
          const vals = line.match(/(".*?"|[^,]+)/g)?.map(v => v.trim().replace(/^"|"$/g,"")) || line.split(",");
          const obj = {};
          headers.forEach((h, i) => { obj[h] = vals[i] || ""; });
          return obj;
        });
        setBatchRawData(rows);

        // ── Compute advanced_sentiment_distribution from actual CSV rows ──
        const advDist = {};
        rows.forEach(row => {
          const adv = (row.advanced_sentiment || "").trim().toLowerCase();
          if (adv && adv !== "" && adv !== "undefined") {
            advDist[adv] = (advDist[adv] || 0) + 1;
          }
        });
        // Compute sentiment_distribution from rows if backend didn't send it
        const sentDist = { positive:0, negative:0, neutral:0 };
        rows.forEach(row => {
          const s = (row.sentiment || "neutral").trim().toLowerCase();
          if (s in sentDist) sentDist[s]++;
        });

        // Merge computed stats into the response summary
        const enrichedSummary = {
          ...d.summary,
          total_entries: d.summary?.total_entries ?? rows.length,
          sentiment_distribution: (d.summary?.sentiment_distribution && Object.keys(d.summary.sentiment_distribution).length > 0)
            ? d.summary.sentiment_distribution : sentDist,
          advanced_sentiment_distribution: (d.summary?.advanced_sentiment_distribution && Object.keys(d.summary.advanced_sentiment_distribution).length > 0)
            ? d.summary.advanced_sentiment_distribution : advDist,
        };
        setBatchResults({ ...d, summary: enrichedSummary });
      } else {
        setBatchResults({ error: d.error });
      }
    } catch (e) {
      setBatchResults({ error: "Backend unavailable — run backend server" });
    }
    setBatchProcessing(false);
  };

  // ── Train model ──
  const runTrain = async (useDefault) => {
    if (!trainModal) return;
    setTraining(true);
    try {
      if (useDefault) {
        const r = await fetch(`${LAPI}/api/legal/train/default`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ model_type: trainModal.type, use_default_data: true }),
        });
        const d = await r.json();
        if (d.success) { setTrainModal(null); checkModels(); }
        else alert(d.error || "Training failed");
      } else {
        if (!trainingFile) return;
        const form = new FormData();
        form.append("file", trainingFile);
        form.append("model_type", trainModal.type);
        const r = await fetch(`${LAPI}/api/legal/train/upload`, { method: "POST", body: form });
        const d = await r.json();
        if (d.success) { setTrainModal(null); setTrainingFile(null); checkModels(); }
        else alert(d.error || "Training failed");
      }
    } catch (_) { alert("Backend unavailable"); }
    setTraining(false);
  };

  // ── Sample test ──
  const runSamples = async () => {
    setSamplesLoading(true);
    setSampleResults(null);
    try {
      const r = await fetch(`${LAPI}/api/legal/test/samples`);
      const d = await r.json();
      if (d.success) setSampleResults(d.data.samples);
    } catch (_) { setSampleResults([]); }
    setSamplesLoading(false);
  };

  // ── Helpers ──
  const SENT_COLOR = { positive: COLORS.greenLight, negative: COLORS.redLight, neutral: COLORS.slateLight };
  const SENT_BG   = { positive: "rgba(39,174,96,0.10)", negative: "rgba(231,76,60,0.10)", neutral: "rgba(127,140,141,0.10)" };

  const filteredBatch = batchRawData.filter(row => {
    if (sentFilter !== "all" && row.sentiment !== sentFilter) return false;
    if (modelFilter !== "all" && row.model_used !== modelFilter) return false;
    if (searchQ) {
      const q = searchQ.toLowerCase();
      return (row.original_comment||"").toLowerCase().includes(q) ||
             (row.clause||"").toLowerCase().includes(q) ||
             (row.reason||"").toLowerCase().includes(q);
    }
    return true;
  });

  const batchModels = [...new Set(batchRawData.map(r => r.model_used).filter(Boolean))];

  const models = [
    { name:"Router Classifier", key:"router_classifier", type:"classifier", icon:"🔀", desc:"Routes text to best BERT model" },
    { name:"InLegalBERT",        key:"inlegalbert",       type:"inlegalbert", icon:"⚖️",  desc:"Supreme Court & High Court judgments" },
    { name:"LegalBERT",          key:"legalbert",         type:"legalbert",   icon:"📋",  desc:"Contracts, agreements, legal opinions" },
    { name:"DistilBERT",         key:"distilbert",        type:"distilbert",  icon:"📰",  desc:"News, blogs, commentary" },
  ];

  // ──────────────────────────────────────────────────────────
  // TAB: ANALYZE
  // ──────────────────────────────────────────────────────────
  const AnalyzeTab = () => (
    <div>
      <Card>
        <h3 style={{ margin:"0 0 6px", fontSize:15, fontWeight:700, color:COLORS.navy }}>⚖️ Analyze Legal Text</h3>
        <p style={{ margin:"0 0 14px", fontSize:13, color:COLORS.slateLight }}>Enter legal text to detect sentiment, extract reasons, identify legal context and key phrases.</p>
        <textarea
          value={analyzeText}
          onChange={e => setAnalyzeText(e.target.value)}
          rows={5}
          placeholder="e.g. The Supreme Court granted the writ petition due to violation of fundamental rights under Article 21."
          style={{ width:"100%", padding:"12px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)",
            fontSize:13, resize:"vertical", fontFamily:"inherit", color:COLORS.navy, outline:"none",
            boxSizing:"border-box", marginBottom:12 }}
        />
        <div style={{ display:"flex", gap:10 }}>
          <button onClick={runAnalyze} disabled={analyzing || !analyzeText.trim()} style={{
            flex:1, padding:"11px", borderRadius:8, border:"none",
            background: analyzeText.trim() ? COLORS.navy : COLORS.slateLight,
            color:COLORS.white, fontSize:14, fontWeight:700, cursor: analyzeText.trim() ? "pointer" : "not-allowed",
            display:"flex", alignItems:"center", justifyContent:"center", gap:8,
          }}>
            {analyzing ? <><Spinner size={16}/> Analyzing...</> : "▶ Analyze Text"}
          </button>
          <button onClick={() => { setAnalyzeText(""); setAnalyzeResult(null); }} style={{
            padding:"11px 20px", borderRadius:8, border:`1.5px solid rgba(11,30,61,0.2)`,
            background:"transparent", color:COLORS.slate, fontSize:14, cursor:"pointer",
          }}>✕ Clear</button>
        </div>
      </Card>

      {/* Results */}
      {analyzeResult && (
        <div style={{ marginTop:20 }}>
          {analyzeResult.error ? (
            <Card style={{ borderLeft:`4px solid ${COLORS.redLight}` }}>
              <p style={{ color:COLORS.redLight, margin:0, fontSize:14 }}>⚠ {analyzeResult.error}</p>
            </Card>
          ) : (
            <>
              {/* Summary stats row */}
              {analyzeResult.results?.length > 0 && (() => {
                const rs = analyzeResult.results;
                const pos = rs.filter(r=>r.sentiment==="positive").length;
                const neg = rs.filter(r=>r.sentiment==="negative").length;
                const neu = rs.filter(r=>r.sentiment==="neutral").length;
                const avgConf = rs.reduce((s,r)=>s+r.score,0)/rs.length;
                return (
                  <div style={{ display:"grid", gridTemplateColumns:"repeat(5,1fr)", gap:12, marginBottom:16 }}>
                    {[
                      ["Clauses", rs.length, COLORS.navy],
                      ["Positive", pos, COLORS.greenLight],
                      ["Negative", neg, COLORS.redLight],
                      ["Neutral", neu, COLORS.slateLight],
                      ["Avg Conf.", (avgConf*100).toFixed(1)+"%", COLORS.gold],
                    ].map(([label, val, color]) => (
                      <div key={label} style={{ background:COLORS.cream, borderRadius:10, padding:"14px 12px", textAlign:"center" }}>
                        <div style={{ fontSize:11, color:COLORS.slateLight, textTransform:"uppercase", letterSpacing:0.5, marginBottom:4 }}>{label}</div>
                        <div style={{ fontSize:22, fontWeight:800, color }}>{val}</div>
                      </div>
                    ))}
                  </div>
                );
              })()}

              {/* Spam alert */}
              {analyzeResult.spam_check?.score > 0 && (
                <div style={{ padding:"10px 16px", borderRadius:8, marginBottom:12,
                  background: analyzeResult.spam_check.is_spam ? "rgba(231,76,60,0.1)" : "rgba(39,174,96,0.1)",
                  border:`1px solid ${analyzeResult.spam_check.is_spam ? COLORS.redLight : COLORS.greenLight}`,
                  display:"flex", gap:8, alignItems:"center", fontSize:13 }}>
                  <span>{analyzeResult.spam_check.is_spam ? "⚠" : "✓"}</span>
                  <span style={{ color: analyzeResult.spam_check.is_spam ? COLORS.redLight : COLORS.greenLight }}>
                    Spam Score: {(analyzeResult.spam_check.score*100).toFixed(1)}% — {analyzeResult.spam_check.reason || "Clean text"}
                  </span>
                </div>
              )}

              {/* Clause results */}
              <div style={{ display:"flex", flexDirection:"column", gap:12 }}>
                {(analyzeResult.results||[]).map((r, i) => (
                  <Card key={i} style={{ borderLeft:`4px solid ${SENT_COLOR[r.sentiment]||COLORS.slateLight}`, background: SENT_BG[r.sentiment]||COLORS.cream }}>
                    {/* Header */}
                    <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:10 }}>
                      <div style={{ display:"flex", gap:8, alignItems:"center" }}>
                        <span style={{ padding:"3px 12px", borderRadius:20, background:SENT_COLOR[r.sentiment]||COLORS.slateLight,
                          color:"#fff", fontSize:12, fontWeight:700 }}>{(r.sentiment||"neutral").toUpperCase()}</span>
                        <span style={{ padding:"3px 10px", borderRadius:20, background:COLORS.cream,
                          border:`1px solid rgba(11,30,61,0.15)`, fontSize:11, color:COLORS.slate }}>
                          🤖 {r.model_used}
                        </span>
                      </div>
                      <span style={{ fontSize:12, color:COLORS.slateLight }}>Clause {i+1}</span>
                    </div>
                    {/* Content rows */}
                    {[
                      ["Text", r.sentence],
                      ["Advanced", r.advanced_sentiment],
                      ["Reason", r.reason],
                      ["Confidence", (r.score*100).toFixed(1)+"%"],
                    ].map(([label, val]) => val && (
                      <div key={label} style={{ display:"grid", gridTemplateColumns:"110px 1fr", gap:8, marginBottom:6, fontSize:13 }}>
                        <span style={{ fontWeight:700, color:COLORS.navy }}>{label}:</span>
                        <span style={{ color:COLORS.slate, lineHeight:1.5 }}>{val}</span>
                      </div>
                    ))}
                    {/* Key phrases */}
                    {r.key_phrases?.length > 0 && (
                      <div style={{ display:"grid", gridTemplateColumns:"110px 1fr", gap:8, marginBottom:6, fontSize:13 }}>
                        <span style={{ fontWeight:700, color:COLORS.navy }}>Key Phrases:</span>
                        <div style={{ display:"flex", flexWrap:"wrap", gap:4 }}>
                          {r.key_phrases.map((p,pi) => (
                            <span key={pi} style={{ padding:"2px 10px", borderRadius:20, background:`rgba(11,30,61,0.08)`,
                              fontSize:12, color:COLORS.navy, border:`1px solid rgba(11,30,61,0.12)` }}>{p}</span>
                          ))}
                        </div>
                      </div>
                    )}
                    {/* Legal context */}
                    {r.legal_context && Object.keys(r.legal_context).length > 0 && (
                      <div style={{ display:"grid", gridTemplateColumns:"110px 1fr", gap:8, fontSize:13 }}>
                        <span style={{ fontWeight:700, color:COLORS.navy }}>Legal Context:</span>
                        <span style={{ color:COLORS.slate }}>{Object.entries(r.legal_context).map(([k,v])=>`${k}: ${v}`).join(" · ")}</span>
                      </div>
                    )}
                  </Card>
                ))}
              </div>
            </>
          )}
        </div>
      )}
    </div>
  );

  // ──────────────────────────────────────────────────────────
  // TAB: BATCH
  // ──────────────────────────────────────────────────────────
  const BatchTab = () => (
    <div>
      <Card>
        <h3 style={{ margin:"0 0 6px", fontSize:15, fontWeight:700, color:COLORS.navy }}>📂 Batch Process CSV</h3>
        <p style={{ margin:"0 0 14px", fontSize:13, color:COLORS.slateLight }}>Upload a CSV file with a <code>text</code>, <code>comment</code>, or <code>sentence</code> column for bulk analysis.</p>

        {/* Drop zone */}
        <div
          onDragOver={e => { e.preventDefault(); e.currentTarget.style.borderColor = COLORS.gold; }}
          onDragLeave={e => { e.currentTarget.style.borderColor = "rgba(11,30,61,0.2)"; }}
          onDrop={e => { e.preventDefault(); e.currentTarget.style.borderColor="rgba(11,30,61,0.2)"; const f=e.dataTransfer.files[0]; if(f?.name.endsWith(".csv")) setBatchFile(f); }}
          onClick={() => document.getElementById("batchFileInput").click()}
          style={{ border:"2px dashed rgba(11,30,61,0.2)", borderRadius:12, padding:"36px 20px",
            textAlign:"center", cursor:"pointer", marginBottom:14,
            background: batchFile ? "rgba(201,168,76,0.05)" : COLORS.cream, transition:"all 0.2s" }}>
          <input id="batchFileInput" type="file" accept=".csv" style={{ display:"none" }}
            onChange={e => e.target.files[0] && setBatchFile(e.target.files[0])} />
          <div style={{ fontSize:32, marginBottom:8 }}>☁️</div>
          <div style={{ fontSize:14, fontWeight:600, color:COLORS.navy, marginBottom:4 }}>
            {batchFile ? `✓ ${batchFile.name}` : "Drag & Drop CSV File Here"}
          </div>
          <div style={{ fontSize:12, color:COLORS.slateLight }}>
            {batchFile ? `${(batchFile.size/1024).toFixed(1)} KB — click to change` : "or click to browse — CSV only"}
          </div>
        </div>

        <button onClick={runBatch} disabled={!batchFile || batchProcessing} style={{
          width:"100%", padding:"12px", borderRadius:8, border:"none",
          background: batchFile && !batchProcessing ? COLORS.navy : COLORS.slateLight,
          color:COLORS.white, fontSize:14, fontWeight:700, cursor: batchFile && !batchProcessing ? "pointer" : "not-allowed",
          display:"flex", alignItems:"center", justifyContent:"center", gap:8,
        }}>
          {batchProcessing ? <><Spinner size={16}/> Processing CSV...</> : "▶ Analyze Batch"}
        </button>
      </Card>

      {/* Batch error */}
      {batchResults?.error && (
        <Card style={{ marginTop:16, borderLeft:`4px solid ${COLORS.redLight}` }}>
          <p style={{ color:COLORS.redLight, margin:0 }}>⚠ {batchResults.error}</p>
        </Card>
      )}

      {/* Batch results */}
      {batchResults?.success && batchRawData.length > 0 && (
        <div style={{ marginTop:16 }}>
          {/* ── Batch Analysis Summary — Image 2 style ── */}
          <Card style={{ marginBottom:16 }}>
            <h4 style={{ margin:"0 0 18px", fontSize:15, fontWeight:700, color:COLORS.navy, display:"flex", alignItems:"center", gap:8 }}>
              <span>🥧</span> Batch Analysis Summary
            </h4>

            {/* Top row — main stat boxes */}
            <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fit, minmax(130px, 1fr))", gap:12, marginBottom:16 }}>
              {/* Total Entries */}
              <div style={{ padding:"16px 14px", borderRadius:12, background:COLORS.cream,
                border:`2px solid rgba(11,30,61,0.1)`, textAlign:"center" }}>
                <div style={{ fontSize:11, fontWeight:700, color:COLORS.slateLight, textTransform:"uppercase", letterSpacing:0.8, marginBottom:6 }}>Total Entries</div>
                <div style={{ fontSize:28, fontWeight:800, color:COLORS.navy }}>{batchResults.summary?.total_entries ?? batchRawData.length}</div>
              </div>

              {/* Neutral */}
              <div style={{ padding:"16px 14px", borderRadius:12, textAlign:"center",
                background:"rgba(113,128,150,0.08)", border:`2px solid rgba(113,128,150,0.25)` }}>
                <div style={{ fontSize:11, fontWeight:700, color:COLORS.slateLight, textTransform:"uppercase", letterSpacing:0.8, marginBottom:6 }}>Neutral</div>
                <div style={{ fontSize:28, fontWeight:800, color:COLORS.slateLight }}>
                  {batchResults.summary?.sentiment_distribution?.neutral ?? batchRawData.filter(r=>r.sentiment==="neutral").length}
                </div>
              </div>

              {/* Negative */}
              <div style={{ padding:"16px 14px", borderRadius:12, textAlign:"center",
                background:"rgba(231,76,60,0.08)", border:`2px solid rgba(231,76,60,0.25)` }}>
                <div style={{ fontSize:11, fontWeight:700, color:COLORS.redLight, textTransform:"uppercase", letterSpacing:0.8, marginBottom:6 }}>Negative</div>
                <div style={{ fontSize:28, fontWeight:800, color:COLORS.redLight }}>
                  {batchResults.summary?.sentiment_distribution?.negative ?? batchRawData.filter(r=>r.sentiment==="negative").length}
                </div>
              </div>

              {/* Positive */}
              <div style={{ padding:"16px 14px", borderRadius:12, textAlign:"center",
                background:"rgba(34,168,109,0.08)", border:`2px solid rgba(34,168,109,0.25)` }}>
                <div style={{ fontSize:11, fontWeight:700, color:COLORS.greenLight, textTransform:"uppercase", letterSpacing:0.8, marginBottom:6 }}>Positive</div>
                <div style={{ fontSize:28, fontWeight:800, color:COLORS.greenLight }}>
                  {batchResults.summary?.sentiment_distribution?.positive ?? batchRawData.filter(r=>r.sentiment==="positive").length}
                </div>
              </div>

              {/* Spam Detected */}
              {(batchResults.summary?.spam_detected > 0) && (
                <div style={{ padding:"16px 14px", borderRadius:12, textAlign:"center",
                  background:"rgba(231,76,60,0.06)", border:`2px solid rgba(231,76,60,0.2)` }}>
                  <div style={{ fontSize:11, fontWeight:700, color:COLORS.redLight, textTransform:"uppercase", letterSpacing:0.8, marginBottom:6 }}>Spam Detected</div>
                  <div style={{ fontSize:28, fontWeight:800, color:COLORS.redLight }}>{batchResults.summary.spam_detected}</div>
                </div>
              )}

            </div>

            {/* Progress bars for sentiment visual */}
            {(() => {
              const total = batchRawData.length || 1;
              const pos = batchResults.summary?.sentiment_distribution?.positive ?? batchRawData.filter(r=>r.sentiment==="positive").length;
              const neg = batchResults.summary?.sentiment_distribution?.negative ?? batchRawData.filter(r=>r.sentiment==="negative").length;
              const neu = batchResults.summary?.sentiment_distribution?.neutral  ?? batchRawData.filter(r=>r.sentiment==="neutral").length;
              return (
                <div style={{ marginBottom:20 }}>
                  {[["Positive", pos, COLORS.greenLight], ["Negative", neg, COLORS.redLight], ["Neutral", neu, COLORS.slateLight]].map(([label, count, color]) => (
                    <div key={label} style={{ marginBottom:8 }}>
                      <div style={{ display:"flex", justifyContent:"space-between", marginBottom:3, fontSize:12 }}>
                        <span style={{ fontWeight:700, color:COLORS.slate }}>{label}</span>
                        <span style={{ color:COLORS.slateLight }}>{count} &nbsp;·&nbsp; {Math.round(count/total*100)}%</span>
                      </div>
                      <div style={{ height:8, borderRadius:20, background:"rgba(11,30,61,0.08)", overflow:"hidden" }}>
                        <div style={{ height:"100%", width:`${Math.round(count/total*100)}%`, borderRadius:20,
                          background:`linear-gradient(90deg, ${color}, ${color}cc)`, transition:"width 0.6s ease" }} />
                      </div>
                    </div>
                  ))}
                </div>
              );
            })()}

            {/* ── Advanced Sentiments — always computed from raw data ── */}
            {(() => {
              // Build distribution from raw CSV rows (never depends on backend summary)
              const advDist = {};
              batchRawData.forEach(row => {
                const adv = (row.advanced_sentiment || "").trim().toLowerCase();
                if (adv && adv !== "" && adv !== "undefined" && adv !== "n/a") {
                  advDist[adv] = (advDist[adv] || 0) + 1;
                }
              });

              // Also merge backend summary data if available
              const backendAdv = batchResults.summary?.advanced_sentiment_distribution || {};
              Object.entries(backendAdv).forEach(([k, v]) => {
                const key = k.trim().toLowerCase();
                if (key) advDist[key] = Math.max(advDist[key] || 0, v);
              });

              const sorted = Object.entries(advDist).sort((a,b) => b[1]-a[1]);
              if (sorted.length === 0) return null;

              // Color per advanced sentiment type
              const advColor = (key) => {
                const k = key.toLowerCase();
                if (["granted","allowed","acquitted","resolved","approved","upheld","complied","settled","executed","discharged","performed","registered"].includes(k))
                  return { bg:"rgba(34,168,109,0.09)", border:"rgba(34,168,109,0.3)", label:COLORS.greenLight, val:COLORS.greenLight };
                if (["dismissed","rejected","convicted","fined","terminated","breached","penalized","revoked","violated","imprisoned","refused","denied"].includes(k))
                  return { bg:"rgba(231,76,60,0.09)", border:"rgba(231,76,60,0.3)", label:COLORS.redLight, val:COLORS.redLight };
                return { bg:"rgba(113,128,150,0.09)", border:"rgba(113,128,150,0.28)", label:COLORS.slateLight, val:COLORS.slate };
              };

              return (
                <div style={{ marginTop:4 }}>
                  <div style={{ fontSize:12, fontWeight:700, color:COLORS.navy, textTransform:"uppercase",
                    letterSpacing:0.8, marginBottom:12, display:"flex", alignItems:"center", gap:6 }}>
                    <span>🔍</span> Advanced Sentiments
                  </div>
                  <div style={{ display:"flex", flexWrap:"wrap", gap:10 }}>
                    {sorted.map(([key, count]) => {
                      const c = advColor(key);
                      return (
                        <div key={key} style={{
                          padding:"14px 18px", borderRadius:12, textAlign:"center",
                          background: c.bg, border:`1.5px solid ${c.border}`,
                          minWidth:96, flex:"0 0 auto", boxShadow:"0 1px 4px rgba(0,0,0,0.05)",
                        }}>
                          <div style={{ fontSize:11, fontWeight:700, color:c.label,
                            textTransform:"capitalize", letterSpacing:0.4, marginBottom:6 }}>{key}</div>
                          <div style={{ fontSize:26, fontWeight:800, color:c.val, lineHeight:1 }}>{count}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              );
            })()}
          </Card>

          {/* Filters */}
          <Card style={{ marginBottom:16 }}>
            <h4 style={{ margin:"0 0 12px", fontSize:13, fontWeight:700, color:COLORS.navy }}>🔍 Filter Results</h4>
            <div style={{ display:"flex", flexWrap:"wrap", gap:16 }}>
              {/* Sentiment filter */}
              <div>
                <div style={{ fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:6, textTransform:"uppercase" }}>Sentiment</div>
                <div style={{ display:"flex", gap:6 }}>
                  {["all","positive","negative","neutral"].map(s => (
                    <button key={s} onClick={() => setSentFilter(s)} style={{
                      padding:"5px 12px", borderRadius:20, border:`1.5px solid ${sentFilter===s ? (SENT_COLOR[s]||COLORS.navy) : "rgba(11,30,61,0.15)"}`,
                      background: sentFilter===s ? (SENT_BG[s]||"rgba(11,30,61,0.08)") : "transparent",
                      color: sentFilter===s ? (SENT_COLOR[s]||COLORS.navy) : COLORS.slate,
                      fontSize:12, fontWeight:600, cursor:"pointer", textTransform:"capitalize",
                    }}>{s}</button>
                  ))}
                </div>
              </div>
              {/* Model filter */}
              <div>
                <div style={{ fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:6, textTransform:"uppercase" }}>Model</div>
                <div style={{ display:"flex", gap:6, flexWrap:"wrap" }}>
                  {["all",...batchModels].map(m => (
                    <button key={m} onClick={() => setModelFilter(m)} style={{
                      padding:"5px 12px", borderRadius:20, border:`1.5px solid ${modelFilter===m ? COLORS.navy : "rgba(11,30,61,0.15)"}`,
                      background: modelFilter===m ? "rgba(11,30,61,0.08)" : "transparent",
                      color: modelFilter===m ? COLORS.navy : COLORS.slate,
                      fontSize:12, fontWeight:600, cursor:"pointer",
                    }}>{m}</button>
                  ))}
                </div>
              </div>
              {/* Search */}
              <div style={{ flex:1, minWidth:200 }}>
                <div style={{ fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:6, textTransform:"uppercase" }}>Search</div>
                <input value={searchQ} onChange={e => setSearchQ(e.target.value)} placeholder="Search comments, clauses, reasons..."
                  style={{ width:"100%", padding:"7px 12px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)",
                    fontSize:13, outline:"none", color:COLORS.navy, boxSizing:"border-box" }} />
              </div>
            </div>
            <div style={{ marginTop:10, fontSize:12, color:COLORS.slateLight }}>
              Showing <strong>{filteredBatch.length}</strong> of <strong>{batchRawData.length}</strong> results
            </div>
          </Card>

          {/* Grouped results */}
          <div style={{ display:"flex", flexDirection:"column", gap:12 }}>
            {(() => {
              const grouped = {};
              filteredBatch.forEach(row => {
                const key = row.original_comment || row.clause || "";
                if (!grouped[key]) grouped[key] = { original: key, spam_score: row.spam_score, clauses: [] };
                grouped[key].clauses.push(row);
              });
              return Object.values(grouped).slice(0, 50).map((item, gi) => {
                const mainSent = item.clauses[0]?.sentiment || "neutral";
                return (
                  <Card key={gi} style={{ borderLeft:`4px solid ${SENT_COLOR[mainSent]||COLORS.slateLight}` }}>
                    {/* Comment header */}
                    <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:10 }}>
                      <span style={{ fontSize:12, fontWeight:700, color:COLORS.slateLight }}>#{gi+1}</span>
                      <span style={{ padding:"3px 12px", borderRadius:20, background:SENT_COLOR[mainSent]||COLORS.slateLight,
                        color:"#fff", fontSize:11, fontWeight:700 }}>{mainSent.toUpperCase()}</span>
                    </div>
                    {/* Original text */}
                    <p style={{ margin:"0 0 10px", fontSize:13, color:COLORS.navy, lineHeight:1.6,
                      padding:"10px 14px", borderRadius:8, background:"rgba(11,30,61,0.04)",
                      borderLeft:`3px solid rgba(11,30,61,0.15)` }}>
                      "{item.original}"
                    </p>
                    {/* Spam badge */}
                    {item.spam_score && item.spam_score !== "0.00%" && (
                      <div style={{ padding:"6px 12px", borderRadius:6, background:"rgba(231,76,60,0.08)",
                        color:COLORS.redLight, fontSize:12, marginBottom:10, border:`1px solid rgba(231,76,60,0.2)` }}>
                        ⚠ Spam Score: {item.spam_score}
                      </div>
                    )}
                    {/* Clauses */}
                    {item.clauses.map((cl, ci) => (
                      <div key={ci} style={{ marginBottom: ci < item.clauses.length-1 ? 10 : 0,
                        padding:"12px", borderRadius:8,
                        background: SENT_BG[cl.sentiment]||"rgba(127,140,141,0.08)",
                        border:`1px solid rgba(11,30,61,0.08)` }}>
                        <div style={{ display:"flex", gap:8, marginBottom:8 }}>
                          <span style={{ fontSize:11, fontWeight:700, color:COLORS.slateLight }}>Clause {ci+1}</span>
                          <span style={{ padding:"2px 10px", borderRadius:20, background:SENT_COLOR[cl.sentiment]||COLORS.slateLight,
                            color:"#fff", fontSize:11, fontWeight:700 }}>{(cl.sentiment||"neutral").toUpperCase()}</span>
                        </div>
                        {cl.clause && <p style={{ margin:"0 0 8px", fontSize:13, color:COLORS.slate }}>{cl.clause}</p>}
                        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6 }}>
                          {[["Advanced", cl.advanced_sentiment], ["Reason", cl.reason], ["Confidence", cl.confidence_score], ["Model", cl.model_used]].map(([k,v]) => v && (
                            <div key={k} style={{ fontSize:12, color:COLORS.slate }}>
                              <span style={{ fontWeight:700, color:COLORS.navy }}>{k}: </span>{v}
                            </div>
                          ))}
                        </div>
                        {cl.key_phrases && cl.key_phrases.length > 2 && (
                          <div style={{ marginTop:6, display:"flex", flexWrap:"wrap", gap:4 }}>
                            {cl.key_phrases.split(", ").filter(Boolean).map((p,pi) => (
                              <span key={pi} style={{ padding:"2px 8px", borderRadius:20, background:"rgba(11,30,61,0.07)",
                                fontSize:11, color:COLORS.navy }}>{p}</span>
                            ))}
                          </div>
                        )}
                      </div>
                    ))}
                  </Card>
                );
              });
            })()}
          </div>
        </div>
      )}
    </div>
  );

  // ──────────────────────────────────────────────────────────
  // TAB: TRAIN MODELS
  // ──────────────────────────────────────────────────────────
  const TrainTab = () => (
    <div>
      {/* Status bar */}
      <Card style={{ marginBottom:16 }}>
        <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:12 }}>
          <h3 style={{ margin:0, fontSize:15, fontWeight:700, color:COLORS.navy }}>🧠 Model Training</h3>
          <div style={{ display:"flex", alignItems:"center", gap:6, fontSize:12,
            padding:"5px 14px", borderRadius:20,
            background: Object.values(modelStatus).some(Boolean) ? "rgba(39,174,96,0.1)" : "rgba(231,76,60,0.1)",
            color: Object.values(modelStatus).some(Boolean) ? COLORS.greenLight : COLORS.redLight,
            border:`1px solid currentColor` }}>
            <span style={{ width:8, height:8, borderRadius:"50%",
              background: Object.values(modelStatus).some(Boolean) ? COLORS.greenLight : COLORS.redLight,
              display:"inline-block" }} />
            {statusChecked ? (Object.values(modelStatus).filter(Boolean).length + "/" + Object.keys(modelStatus).length + " Models Ready · " + deviceInfo.toUpperCase()) : "Checking..."}
          </div>
        </div>
        <p style={{ margin:0, fontSize:13, color:COLORS.slateLight }}>
          Train the router classifier and BERT models with default embedded data or upload your own CSV training data.
        </p>
      </Card>

      {/* Model cards */}
      <div style={{ display:"grid", gridTemplateColumns:"repeat(2,1fr)", gap:16 }}>
        {models.map(m => (
          <Card key={m.key} style={{ borderTop:`4px solid ${modelStatus[m.key] ? COLORS.greenLight : "rgba(11,30,61,0.15)"}` }}>
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:8 }}>
              <div>
                <div style={{ fontSize:24, marginBottom:4 }}>{m.icon}</div>
                <div style={{ fontSize:14, fontWeight:700, color:COLORS.navy }}>{m.name}</div>
                <div style={{ fontSize:12, color:COLORS.slateLight, marginTop:2 }}>{m.desc}</div>
              </div>
              <span style={{ padding:"4px 12px", borderRadius:20, fontSize:11, fontWeight:700,
                background: modelStatus[m.key] ? "rgba(39,174,96,0.12)" : "rgba(231,76,60,0.10)",
                color: modelStatus[m.key] ? COLORS.greenLight : COLORS.redLight,
                border:`1px solid currentColor`, whiteSpace:"nowrap" }}>
                {modelStatus[m.key] ? "✓ Trained" : "✗ Not Trained"}
              </span>
            </div>
            <button onClick={() => setTrainModal({ type: m.type, step: "choose" })} style={{
              width:"100%", padding:"9px", borderRadius:8,
              border:`1.5px solid ${COLORS.navyLight}`, background:"transparent",
              color:COLORS.navy, fontSize:13, fontWeight:600, cursor:"pointer", marginTop:8,
            }}>▶ Train Model</button>
          </Card>
        ))}
        {/* Train All */}
        <Card style={{ gridColumn:"span 2", borderTop:`4px solid ${COLORS.gold}` }}>
          <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center" }}>
            <div>
              <div style={{ fontSize:14, fontWeight:700, color:COLORS.navy }}>🚀 Quick Train — All Models</div>
              <div style={{ fontSize:12, color:COLORS.slateLight, marginTop:2 }}>Train all 4 models at once with default embedded data</div>
            </div>
            <button onClick={() => setTrainModal({ type:"all", step:"choose" })} style={{
              padding:"10px 24px", borderRadius:8, border:"none",
              background:COLORS.navy, color:COLORS.white, fontSize:13, fontWeight:700, cursor:"pointer",
            }}>🚀 Quick Train All</button>
          </div>
        </Card>
      </div>

      {/* Training modal overlay */}
      {trainModal && (
        <div style={{ position:"fixed", inset:0, background:"rgba(0,0,0,0.5)", zIndex:1000,
          display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e => { if (e.target === e.currentTarget && !training) { setTrainModal(null); setTrainingFile(null); } }}>
          <div style={{ background:"#fff", borderRadius:16, padding:28, width:"100%", maxWidth:440,
            boxShadow:"0 20px 60px rgba(0,0,0,0.25)" }}>
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20 }}>
              <h3 style={{ margin:0, fontSize:16, fontWeight:700, color:COLORS.navy }}>🧠 Train {trainModal.type}</h3>
              {!training && <button onClick={() => { setTrainModal(null); setTrainingFile(null); }}
                style={{ background:"none", border:"none", fontSize:20, cursor:"pointer", color:COLORS.slateLight }}>✕</button>}
            </div>

            {trainModal.step === "choose" && (
              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:12 }}>
                {[
                  { label:"Use Default Data", icon:"🗄️", desc:"Train with built-in examples", onClick: () => setTrainModal({...trainModal, step:"default"}) },
                  { label:"Upload Custom CSV", icon:"📤", desc:"Train with your own data", onClick: () => setTrainModal({...trainModal, step:"upload"}) },
                ].map(opt => (
                  <button key={opt.label} onClick={opt.onClick} style={{
                    padding:"20px 14px", borderRadius:12, border:`1.5px solid rgba(11,30,61,0.2)`,
                    background:COLORS.cream, cursor:"pointer", textAlign:"center",
                  }}>
                    <div style={{ fontSize:28, marginBottom:8 }}>{opt.icon}</div>
                    <div style={{ fontSize:13, fontWeight:700, color:COLORS.navy, marginBottom:4 }}>{opt.label}</div>
                    <div style={{ fontSize:11, color:COLORS.slateLight }}>{opt.desc}</div>
                  </button>
                ))}
              </div>
            )}

            {trainModal.step === "default" && (
              <div>
                <p style={{ fontSize:14, color:COLORS.slate, marginBottom:20 }}>
                  Train <strong>{trainModal.type}</strong> using embedded training data. This may take a few minutes.
                </p>
                <button onClick={() => runTrain(true)} disabled={training} style={{
                  width:"100%", padding:"12px", borderRadius:8, border:"none",
                  background: training ? COLORS.slateLight : COLORS.navy,
                  color:"#fff", fontSize:14, fontWeight:700, cursor: training ? "not-allowed" : "pointer",
                  display:"flex", alignItems:"center", justifyContent:"center", gap:8,
                }}>
                  {training ? <><Spinner size={16}/> Training...</> : "✓ Confirm Training"}
                </button>
              </div>
            )}

            {trainModal.step === "upload" && (
              <div>
                <div onClick={() => document.getElementById("trainFileInput").click()}
                  style={{ border:"2px dashed rgba(11,30,61,0.2)", borderRadius:10, padding:"24px",
                    textAlign:"center", cursor:"pointer", marginBottom:14, background:COLORS.cream }}>
                  <input id="trainFileInput" type="file" accept=".csv" style={{ display:"none" }}
                    onChange={e => e.target.files[0] && setTrainingFile(e.target.files[0])} />
                  <div style={{ fontSize:28, marginBottom:6 }}>📤</div>
                  <div style={{ fontSize:13, color: trainingFile ? COLORS.greenLight : COLORS.slate, fontWeight:600 }}>
                    {trainingFile ? `✓ ${trainingFile.name}` : "Click to select CSV file"}
                  </div>
                </div>
                <button onClick={() => runTrain(false)} disabled={!trainingFile || training} style={{
                  width:"100%", padding:"12px", borderRadius:8, border:"none",
                  background: trainingFile && !training ? COLORS.navy : COLORS.slateLight,
                  color:"#fff", fontSize:14, fontWeight:700, cursor: trainingFile && !training ? "pointer" : "not-allowed",
                  display:"flex", alignItems:"center", justifyContent:"center", gap:8,
                }}>
                  {training ? <><Spinner size={16}/> Uploading & Training...</> : "📤 Upload & Train"}
                </button>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );

  // ──────────────────────────────────────────────────────────
  // TAB: DASHBOARD
  // ──────────────────────────────────────────────────────────
  const DashboardTab = () => (
    <div>
      {/* Sample tests */}
      <Card style={{ marginBottom:16 }}>
        <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:12 }}>
          <div>
            <h3 style={{ margin:"0 0 4px", fontSize:15, fontWeight:700, color:COLORS.navy }}>🧪 Test with Sample Comments</h3>
            <p style={{ margin:0, fontSize:13, color:COLORS.slateLight }}>Run 10 built-in legal text samples through the full pipeline</p>
          </div>
          <button onClick={runSamples} disabled={samplesLoading} style={{
            padding:"10px 20px", borderRadius:8, border:"none",
            background: samplesLoading ? COLORS.slateLight : COLORS.navy,
            color:"#fff", fontSize:13, fontWeight:700, cursor: samplesLoading ? "not-allowed" : "pointer",
            display:"flex", alignItems:"center", gap:8,
          }}>
            {samplesLoading ? <><Spinner size={14}/> Running...</> : "▶ Run Sample Tests"}
          </button>
        </div>
      </Card>

      {sampleResults && (
        <div style={{ display:"grid", gridTemplateColumns:"repeat(2,1fr)", gap:12, marginBottom:20 }}>
          {sampleResults.map((s, i) => {
            const first = s.results?.[0] || {};
            return (
              <Card key={i} style={{ borderLeft:`4px solid ${SENT_COLOR[first.sentiment]||COLORS.slateLight}` }}>
                <p style={{ margin:"0 0 8px", fontSize:13, color:COLORS.navy, lineHeight:1.5 }}>
                  {(s.original_text||"").slice(0,100)}{(s.original_text||"").length>100?"...":""}
                </p>
                {s.error ? (
                  <span style={{ color:COLORS.redLight, fontSize:12 }}>Error: {s.error}</span>
                ) : (
                  <div style={{ fontSize:12, display:"flex", flexDirection:"column", gap:4 }}>
                    <div style={{ display:"flex", gap:8, alignItems:"center" }}>
                      <span style={{ padding:"2px 10px", borderRadius:20, background:SENT_COLOR[first.sentiment]||COLORS.slateLight,
                        color:"#fff", fontWeight:700, fontSize:11 }}>{(first.sentiment||"N/A").toUpperCase()}</span>
                      <span style={{ color:COLORS.slateLight }}>Conf: {first.score ? (first.score*100).toFixed(0)+"%" : "N/A"}</span>
                    </div>
                    <div style={{ color:COLORS.slate }}><strong>Advanced:</strong> {first.advanced_sentiment||"N/A"}</div>
                    <div style={{ color:COLORS.slate }}><strong>Reason:</strong> {first.reason||"N/A"}</div>
                  </div>
                )}
              </Card>
            );
          })}
        </div>
      )}

      {/* Model performance */}
      <Card>
        <h3 style={{ margin:"0 0 14px", fontSize:15, fontWeight:700, color:COLORS.navy }}>📈 Model Overview</h3>
        <div style={{ display:"grid", gridTemplateColumns:"repeat(2,1fr)", gap:12 }}>
          {models.map(m => (
            <div key={m.key} style={{ padding:"14px 16px", borderRadius:10, background:COLORS.cream,
              borderLeft:`3px solid ${modelStatus[m.key] ? COLORS.greenLight : "rgba(11,30,61,0.15)"}` }}>
              <div style={{ fontSize:16, marginBottom:4 }}>{m.icon}</div>
              <div style={{ fontSize:13, fontWeight:700, color:COLORS.navy }}>{m.name}</div>
              <div style={{ fontSize:12, color:COLORS.slateLight, marginBottom:6 }}>{m.desc}</div>
              <span style={{ fontSize:11, fontWeight:700,
                color: modelStatus[m.key] ? COLORS.greenLight : COLORS.redLight }}>
                {modelStatus[m.key] ? "✓ Ready" : "✗ Not Trained"}
              </span>
            </div>
          ))}
        </div>
      </Card>
    </div>
  );

  // ──────────────────────────────────────────────────────────
  // RENDER
  // ──────────────────────────────────────────────────────────
  const TABS = [
    { id:"analyze",   label:"⚖ Analyze",      component: <AnalyzeTab /> },
    { id:"batch",     label:"📂 Batch",        component: <BatchTab /> },
    { id:"train",     label:"🧠 Train Models", component: <TrainTab /> },
    { id:"dashboard", label:"📊 Dashboard",    component: <DashboardTab /> },
  ];

  return (
    <div>
      <SectionTitle icon="brain" title="Sentiment Analysis" subtitle="Legal Text Analysis Pipeline — Multi-model sentiment detection with reason extraction" />

      {/* Tab bar */}
      <div style={{ display:"flex", gap:4, marginBottom:20, borderBottom:`2px solid rgba(11,30,61,0.08)`, paddingBottom:2 }}>
        {TABS.map(t => (
          <button key={t.id} onClick={() => setActiveTab(t.id)} style={{
            padding:"9px 18px", borderRadius:"8px 8px 0 0", border:"none",
            background: activeTab===t.id ? COLORS.navy : "transparent",
            color: activeTab===t.id ? COLORS.white : COLORS.slate,
            fontSize:13, fontWeight:600, cursor:"pointer",
            borderBottom: activeTab===t.id ? `2px solid ${COLORS.navy}` : "2px solid transparent",
          }}>{t.label}</button>
        ))}
      </div>

      {/* Active tab content */}
      {TABS.find(t => t.id === activeTab)?.component}
    </div>
  );
};



// ════════════════════════════════════════════════════════════
// MODULE 4: SUMMARY GENERATOR
// ════════════════════════════════════════════════════════════
const SummaryModule = () => {
  const [text, setText] = useState("");
  const [summaries, setSummaries] = useState(null);
  const [stats, setStats]         = useState(null);   // themes + keywords from pipeline
  const [loading, setLoading]     = useState(false);
  const [mode, setMode] = useState("combined"); // eslint-disable-line no-unused-vars
  const [aiSource, setAiSource]   = useState("");

  const handleFile = (content) => setText(content);

  // ── Local pipeline — reads ACTUAL CSV content, outputs rich structured object ──
  const localPipeline = (inputText) => {
    const rawLines = inputText.split("\n").map(l => l.trim()).filter(l => l.length > 8);
    if (rawLines.length === 0) return { result: null, source: "local", stats: null };

    // Detect CSV with header row
    const firstLow = rawLines[0].toLowerCase();
    const isCSV = firstLow.includes(",") && (
      firstLow.includes("comment") || firstLow.includes("text") ||
      firstLow.includes("feedback") || firstLow.includes("sentiment") || firstLow.includes("user")
    );

    let comments = [];
    if (isCSV) {
      const headers = rawLines[0].split(",").map(h => h.trim().toLowerCase().replace(/"/g,""));
      const textIdx = headers.findIndex(h => ["comment","text","feedback","translated_comment"].includes(h));
      const typeIdx = headers.findIndex(h => ["user_type","type","usertype","user"].includes(h));
      const sentIdx = headers.findIndex(h => ["sentiment","sent","label"].includes(h));
      rawLines.slice(1).forEach(line => {
        // Handle commas inside quoted fields
        const cols = line.match(/(".*?"|[^,]+)/g)?.map(c => c.trim().replace(/^"|"$/g,"")) || line.split(",");
        const txt = (textIdx >= 0 ? cols[textIdx] : cols[0] || "").trim();
        const typ = (typeIdx >= 0 ? cols[typeIdx] : "").toLowerCase().trim();
        const sen = (sentIdx >= 0 ? cols[sentIdx] : "").toLowerCase().trim();
        if (txt.length > 5) comments.push({ text: txt, type: typ, sentiment: sen });
      });
    } else {
      // Plain text — each line is a comment
      rawLines.forEach(l => comments.push({ text: l, type: "", sentiment: "" }));
    }

    const total = comments.length;
    if (total === 0) return { result: null, source: "local", stats: null };

    // STEP 1 — Deduplicate
    const seen = new Set();
    comments = comments.filter(c => {
      const k = c.text.toLowerCase().slice(0, 80);
      if (seen.has(k)) return false; seen.add(k); return true;
    });

    // STEP 2 — Split business vs individual using type column OR keyword detection
    const bizKw = ["company","gst","compliance","enterprise","business","corporate","llp","pvt","ltd",
                   "msme","director","audit","board","shareholder","statutory","contractual","regulatory",
                   "governance","fiduciary","provision","directive","obligation","disclosure"];
    const splitByType = comments.some(c => c.type.includes("business") || c.type.includes("individual") || c.type.includes("biz"));
    const biz = comments.filter(c =>
      splitByType
        ? (c.type.includes("business") || c.type.includes("biz") || c.type.includes("corp"))
        : bizKw.some(k => c.text.toLowerCase().includes(k))
    );
    const ind = comments.filter(c =>
      splitByType
        ? (c.type.includes("individual") || c.type.includes("citizen") || c.type.includes("ind"))
        : !bizKw.some(k => c.text.toLowerCase().includes(k))
    );

    // STEP 3 — Classify each comment pos/neg/neutral
    const posW = ["excellent","clear","helpful","good","great","improved","easy","transparent",
                  "fast","appreciate","simple","beneficial","support","efficient","smooth","simplified",
                  "adherence","robust","timely","strengthened","professionalism","fulfilled","satisfied",
                  "consistent","meticulous","innovative","accessible","streamlined","well","positive"];
    const negW = ["burdensome","harsh","unclear","difficult","complex","penalty","tight","unfair",
                  "concern","problem","confusing","slow","frustrating","costly","excessive","outdated",
                  "crash","error","strict","absence","delay","improper","non-conformity","deficiencies",
                  "failure","risk","breach","sanction","enforcement","violation","not addressed","lacking"];
    const classify = (c) => {
      if (c.sentiment === "positive") return "positive";
      if (c.sentiment === "negative") return "negative";
      if (c.sentiment === "neutral")  return "neutral";
      const t = c.text.toLowerCase();
      const p = posW.filter(w => t.includes(w)).length;
      const n = negW.filter(w => t.includes(w)).length;
      return p > n ? "positive" : n > p ? "negative" : "neutral";
    };

    // STEP 4 — Extract real sentences from the actual CSV comments
    const extractSentences = (group, sentimentType, maxN = 3) => {
      const filtered = group.filter(c => classify(c) === sentimentType);
      if (filtered.length === 0) return [];
      // Sort longest first (more content = more informative)
      const sorted = [...filtered].sort((a, b) => b.text.length - a.text.length);
      const picked = [];
      const startWords = new Set();
      for (const c of sorted) {
        if (picked.length >= maxN) break;
        // Strip trailing CSV columns if any leaked through
        let clean = c.text
          .replace(/,\s*(business|individual|positive|negative|neutral).*/gi, "")
          .replace(/["""]/g, "")
          .trim();
        if (clean.length < 10) continue;
        // Avoid duplicate-starting bullets
        const sw = clean.toLowerCase().split(" ").slice(0,3).join(" ");
        if (startWords.has(sw)) continue;
        startWords.add(sw);
        // Cap at 130 chars
        picked.push(clean.length > 130 ? clean.slice(0, 127) + "..." : clean);
      }
      return picked;
    };

    // STEP 5 — Theme detection from actual content
    const themeMap = {
      compliance:   ["compliance","filing","return","audit","mandatory","regulation","statutory","obligation"],
      digital:      ["portal","online","digital","website","system","e-filing","technical","interface"],
      support:      ["support","helpline","staff","response","grievance","assistance"],
      penalty:      ["penalty","fine","charge","late","strict","harsh","sanction","enforcement"],
      process:      ["process","procedure","requirement","registration","approve","workflow","documentation"],
      msme:         ["msme","small","micro","startup","enterprise","exemption"],
      transparency: ["transparent","clear","accountability","disclosure","governance","fiduciary"],
    };
    const themeHits = {};
    comments.forEach(c => {
      const t = c.text.toLowerCase();
      Object.entries(themeMap).forEach(([theme, words]) => {
        if (words.some(w => t.includes(w))) themeHits[theme] = (themeHits[theme] || 0) + 1;
      });
    });
    const topThemes = Object.entries(themeHits).sort((a,b)=>b[1]-a[1]).slice(0,4).map(([t])=>t);

    // STEP 6 — Extract top keywords from actual file content
    const stopwords = new Set(["the","a","an","is","in","it","of","and","or","to","that","this",
      "was","for","on","are","with","as","at","be","by","from","have","has","had","not","but",
      "we","they","you","i","very","just","so","all","been","more","our","their","its","may",
      "will","can","also","should","would","could","which","were","been","what","when","where",
      "such","been","have","this","than","then","them","these","those","been","some","each"]);
    const wordFreq = {};
    comments.forEach(c => {
      c.text.toLowerCase().match(/[a-z]{4,}/g)?.forEach(w => {
        if (!stopwords.has(w)) wordFreq[w] = (wordFreq[w] || 0) + 1;
      });
    });
    const keywords = Object.entries(wordFreq).sort((a,b)=>b[1]-a[1]).slice(0,12).map(([w])=>w);

    // STEP 7 — Overall sentiment
    const allPos = comments.filter(c => classify(c) === "positive").length;
    const allNeg = comments.filter(c => classify(c) === "negative").length;
    const allNeu = comments.filter(c => classify(c) === "neutral").length;
    const overallLabel = allPos > allNeg * 1.3 ? "predominantly positive"
      : allNeg > allPos * 1.3 ? "predominantly critical" : "mixed";

    // Extract actual sentences for each section
    const bizPos = extractSentences(biz, "positive", 3);
    const bizNeg = extractSentences(biz, "negative", 3);
    const bizNeu = extractSentences(biz, "neutral",  2);
    const indPos = extractSentences(ind, "positive", 2);
    const indNeg = extractSentences(ind, "negative", 3);
    const indNeu = extractSentences(ind, "neutral",  2);

    // Recommendations from actual top concerns in the data
    const topKw = keywords.slice(0,3).join(", ");
    const bizRec = bizNeg.length > 0
      ? `Address identified concerns around ${topKw} through clearer regulatory guidelines and phased timelines.`
      : "Maintain current compliance standards with periodic governance review cycles.";
    const indRec = indNeg.length > 0
      ? `Improve ${topThemes.slice(0,2).join(" and ")} accessibility and documentation for individual users.`
      : "Continue digital infrastructure improvements for better citizen accessibility.";

    // Return structured object for rich rendering in UI
    const structured = {
      business:   { pos: bizPos, neg: bizNeg, neu: bizNeu, rec: bizRec, total: biz.length },
      individual: { pos: indPos, neg: indNeg, neu: indNeu, rec: indRec, total: ind.length },
      overall:    {
        total, bizCount: biz.length, indCount: ind.length, label: overallLabel,
        themes: topThemes.join(", ") || "compliance, process",
        posCount: allPos, negCount: allNeg, neuCount: allNeu,
      },
    };

    return { result: structured, source: "local", stats: { themes: themeHits, keywords, total } };
  };

  const generateSummaries = async () => {
    if (!text.trim()) return;
    setLoading(true);
    setAiSource("");
    setStats(null);

    // Split into business / individual for the new rich endpoint
    const bizKw = ["company","gst","compliance","enterprise","business","corporate","llp","pvt","ltd","msme","director","audit"];
    const lines = text.split("\n").map(l => l.trim()).filter(l => l.length > 8);
    const business   = lines.filter(l => bizKw.some(k => l.toLowerCase().includes(k)));
    const individual = lines.filter(l => !bizKw.some(k => l.toLowerCase().includes(k)));

    let result, source = "local", statsData = null;

    try {
      // Try new rich endpoint first (7-step pipeline + Gemini)
      const res = await Promise.race([
        fetch(`${BACKEND_URL}/api/summary/generate`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ business, individual, raw_text: text }),
        }),
        new Promise((_, rej) => setTimeout(() => rej(new Error("timeout")), 8000))
      ]);
      if (res.ok) {
        const data = await res.json();
        if (data.result) {
          result    = data.result;
          source    = data.source || "ai";
          statsData = data.stats || null;
        }
      }
    } catch (_) {}

    // Local pipeline fallback — always runs if backend unavailable
    if (!result) {
      const local = localPipeline(text);
      result    = local.result;   // now a structured object, not a string
      source    = local.source;
      statsData = local.stats;
    }

    setSummaries(typeof result === "object" && result?.business ? result : { _raw: result });
    setAiSource(source);
    setStats(statsData);
    setLoading(false);
  };

  return (
    <div>
      <SectionTitle icon="file" title="AI Summary Generator" subtitle="Generate structured narrative summaries from feedback data using AI" />
      <div style={{ display:"grid", gridTemplateColumns:"1fr 2fr", gap:20, marginBottom:24 }}>
        <Card>
          <h3 style={{ margin:"0 0 14px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Input</h3>
          <FileUpload onData={handleFile} label="Upload CSV feedback file" />
          <div style={{ margin:"12px 0 4px", fontSize:13, color:COLORS.slateLight }}>— or paste text below —</div>
          <textarea value={text} onChange={e => setText(e.target.value)} rows={7}
            placeholder="Paste feedback comments or policy text here..."
            style={{ width:"100%", padding:"12px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:13, resize:"vertical", fontFamily:"inherit", color:COLORS.navy, outline:"none", boxSizing:"border-box" }}
          />
          <button onClick={() => { const c = db.get("comments") || []; setText(c.map(x => x.text).join("\n")); }} style={{
            marginTop:8, padding:"8px 14px", border:`1px solid ${COLORS.gold}`, borderRadius:6,
            background:"transparent", color:COLORS.gold, fontSize:13, cursor:"pointer", fontWeight:600,
          }}>Load Stored Comments</button>
          <button onClick={generateSummaries} disabled={loading || !text.trim()} style={{
            marginTop:10, width:"100%", padding:"12px", borderRadius:8, border:"none",
            background: (!text.trim() || loading) ? COLORS.slateLight : COLORS.navy,
            color:COLORS.white, fontSize:14, fontWeight:700, cursor: (!text.trim() || loading) ? "not-allowed" : "pointer",
            display:"flex", alignItems:"center", justifyContent:"center", gap:8,
          }}>
            {loading ? <><Spinner size={16} /> Generating Summaries...</> : <><Icon name="spark" size={16} /> Generate AI Summaries</>}
          </button>
        </Card>
        <div>
          {!summaries && !loading && (
            <Card style={{ display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center", minHeight:340, background:COLORS.cream }}>
              <Icon name="file" size={48} color="rgba(11,30,61,0.15)" />
              <p style={{ color:COLORS.slateLight, fontSize:14, marginTop:16, textAlign:"center" }}>Enter feedback text and click Generate to create AI-powered summaries</p>
            </Card>
          )}
          {loading && (
            <Card style={{ display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center", minHeight:340 }}>
              <Spinner size={40} />
              <p style={{ color:COLORS.slateLight, fontSize:14, marginTop:16 }}>AI is generating summaries...</p>
            </Card>
          )}
          {summaries && !loading && (() => {
            const S = summaries;           // structured object from localPipeline
            const isStructured = !!S.business;

            // Sub-components for rendering
            const SectionHeader = ({ label, color }) => (
              <div style={{ margin:"20px 0 10px", paddingBottom:6, borderBottom:`2px solid ${color}` }}>
                <span style={{ fontSize:15, fontWeight:800, color, fontFamily:"Georgia, serif", letterSpacing:0.5 }}>{label}</span>
              </div>
            );
            const SubHeader = ({ label, color }) => (
              <div style={{ margin:"12px 0 6px" }}>
                <span style={{ fontSize:13, fontWeight:700, color, textTransform:"uppercase", letterSpacing:0.8 }}>{label}</span>
              </div>
            );
            const Bullet = ({ text }) => (
              <div style={{ display:"flex", gap:8, marginBottom:5, alignItems:"flex-start" }}>
                <span style={{ color:COLORS.gold, fontWeight:700, flexShrink:0, marginTop:1 }}>-</span>
                <span style={{ fontSize:13, color:COLORS.slate, lineHeight:1.65 }}>{text}</span>
              </div>
            );
            const EmptyNote = () => (
              <div style={{ fontSize:12, color:COLORS.slateLight, fontStyle:"italic", marginBottom:4, paddingLeft:16 }}>
                No specific feedback in this category.
              </div>
            );
            const Divider = () => (
              <div style={{ margin:"18px 0", borderTop:"1.5px dashed rgba(11,30,61,0.12)" }} />
            );

            return (
              <div>
                {/* Source badge */}
                <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:16 }}>
                  <span style={{ fontSize:13, fontWeight:700, color:COLORS.navy }}>📄 Analysis Complete</span>
                  <span style={{ fontSize:11, padding:"4px 14px", borderRadius:20, fontWeight:700,
                    background: aiSource === "gemini-ai" ? "#e8f5e9" : "#fff8e1",
                    color: aiSource === "gemini-ai" ? "#2e7d32" : "#f57f17", border:"1.5px solid currentColor" }}>
                    {aiSource === "gemini-ai" ? "✨ Gemini AI — 7-Step Pipeline" : "🔧 Smart Analyzer — Local Pipeline"}
                  </span>
                </div>

                {/* ── Structured card ── */}
                {isStructured ? (
                  <Card style={{ marginBottom:16, borderLeft:`4px solid ${COLORS.navy}`, maxHeight:560, overflowY:"auto" }}>
                    <h4 style={{ margin:"0 0 4px", fontSize:14, fontWeight:700, color:COLORS.navy }}>📋 Structured Summary</h4>
                    <p style={{ margin:"0 0 12px", fontSize:12, color:COLORS.slateLight }}>
                      Analysed {S.overall?.total || 0} comments — {S.business?.total || 0} business · {S.individual?.total || 0} individual
                    </p>

                    {/* BUSINESS */}
                    <SectionHeader label="BUSINESS:" color={COLORS.navy} />

                    <SubHeader label="Positive:" color={COLORS.greenLight} />
                    {(S.business?.pos?.length > 0) ? S.business.pos.map((t,i) => <Bullet key={i} text={t} />) : <EmptyNote />}

                    <SubHeader label="Negative:" color={COLORS.redLight} />
                    {(S.business?.neg?.length > 0) ? S.business.neg.map((t,i) => <Bullet key={i} text={t} />) : <EmptyNote />}

                    <SubHeader label="Neutral:" color={COLORS.slateLight} />
                    {(S.business?.neu?.length > 0) ? S.business.neu.map((t,i) => <Bullet key={i} text={t} />) : <EmptyNote />}

                    {S.business?.rec && (
                      <div style={{ margin:"10px 0 4px", padding:"10px 14px", borderRadius:8,
                        background:"rgba(201,168,76,0.07)", border:`1px solid rgba(201,168,76,0.25)` }}>
                        <span style={{ fontSize:12, fontWeight:700, color:COLORS.amber }}>💡 Recommendation: </span>
                        <span style={{ fontSize:12, color:COLORS.slate }}>{S.business.rec}</span>
                      </div>
                    )}

                    <Divider />

                    {/* INDIVIDUAL */}
                    <SectionHeader label="INDIVIDUAL:" color="#7B5EA7" />

                    <SubHeader label="Positive:" color={COLORS.greenLight} />
                    {(S.individual?.pos?.length > 0) ? S.individual.pos.map((t,i) => <Bullet key={i} text={t} />) : <EmptyNote />}

                    <SubHeader label="Negative:" color={COLORS.redLight} />
                    {(S.individual?.neg?.length > 0) ? S.individual.neg.map((t,i) => <Bullet key={i} text={t} />) : <EmptyNote />}

                    <SubHeader label="Neutral:" color={COLORS.slateLight} />
                    {(S.individual?.neu?.length > 0) ? S.individual.neu.map((t,i) => <Bullet key={i} text={t} />) : <EmptyNote />}

                    {S.individual?.rec && (
                      <div style={{ margin:"10px 0 4px", padding:"10px 14px", borderRadius:8,
                        background:"rgba(201,168,76,0.07)", border:`1px solid rgba(201,168,76,0.25)` }}>
                        <span style={{ fontSize:12, fontWeight:700, color:COLORS.amber }}>💡 Recommendation: </span>
                        <span style={{ fontSize:12, color:COLORS.slate }}>{S.individual.rec}</span>
                      </div>
                    )}

                    <Divider />

                    {/* OVERALL */}
                    <SectionHeader label="OVERALL ASSESSMENT:" color={COLORS.navyLight} />
                    {S.overall && (
                      <div style={{ fontSize:13, color:COLORS.slate, lineHeight:1.75 }}>
                        <p style={{ margin:"0 0 6px" }}>
                          A total of <strong>{S.overall.total}</strong> submissions
                          ({S.overall.bizCount} business, {S.overall.indCount} individual)
                          were analysed, revealing a <strong>{S.overall.label}</strong> response.
                        </p>
                        <p style={{ margin:"0 0 6px" }}>
                          Key themes identified: <strong>{S.overall.themes}</strong>.
                        </p>
                        <p style={{ margin:0 }}>
                          Positive: {S.overall.posCount} · Negative: {S.overall.negCount} · Neutral: {S.overall.neuCount}
                        </p>
                      </div>
                    )}
                  </Card>
                ) : (
                  // Fallback: plain text (e.g. from Gemini API as string)
                  <Card style={{ marginBottom:16, borderLeft:`4px solid ${COLORS.navy}` }}>
                    <h4 style={{ margin:"0 0 14px", fontSize:14, fontWeight:700, color:COLORS.navy }}>📋 Summary</h4>
                    <pre style={{ margin:0, fontSize:13, color:COLORS.slate, lineHeight:1.9,
                      whiteSpace:"pre-wrap", fontFamily:"inherit" }}>
                      {S._raw || JSON.stringify(S, null, 2)}
                    </pre>
                  </Card>
                )}

                {/* Themes + Keywords panel */}
                {stats && (
                  <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:16, marginBottom:16 }}>
                    <Card style={{ borderLeft:`4px solid ${COLORS.gold}` }}>
                      <h4 style={{ margin:"0 0 12px", fontSize:13, fontWeight:700, color:COLORS.navy }}>🏷️ Detected Themes</h4>
                      <div style={{ display:"flex", flexDirection:"column", gap:7 }}>
                        {Object.entries(stats.themes || {}).sort((a,b)=>b[1]-a[1]).slice(0,6).map(([theme, count]) => (
                          <div key={theme} style={{ display:"flex", alignItems:"center", justifyContent:"space-between" }}>
                            <span style={{ fontSize:13, color:COLORS.slate, textTransform:"capitalize" }}>{theme}</span>
                            <div style={{ display:"flex", alignItems:"center", gap:6 }}>
                              <div style={{ width: Math.min(90, count * 6), height:6, borderRadius:3,
                                background:`linear-gradient(90deg, ${COLORS.navyLight}, ${COLORS.gold})` }} />
                              <span style={{ fontSize:11, color:COLORS.slateLight, minWidth:20 }}>{count}</span>
                            </div>
                          </div>
                        ))}
                      </div>
                    </Card>
                    <Card style={{ borderLeft:`4px solid ${COLORS.greenLight}` }}>
                      <h4 style={{ margin:"0 0 12px", fontSize:13, fontWeight:700, color:COLORS.navy }}>🔑 Top Keywords</h4>
                      <div style={{ display:"flex", flexWrap:"wrap", gap:6 }}>
                        {(stats.keywords || []).slice(0,12).map((kw, i) => (
                          <span key={kw} style={{ padding:"3px 10px", borderRadius:20, fontSize:12, fontWeight:600,
                            background: i < 3 ? "rgba(11,30,61,0.1)" : COLORS.cream,
                            color: i < 3 ? COLORS.navy : COLORS.slate,
                            border:`1px solid ${i < 3 ? COLORS.navyLight : "rgba(11,30,61,0.1)"}` }}>
                            {kw}
                          </span>
                        ))}
                      </div>
                      {stats.total && (
                        <p style={{ margin:"12px 0 0", fontSize:12, color:COLORS.slateLight }}>
                          Analysed: <strong>{stats.total}</strong> comments · Pipeline: Clean → Rank → Cluster → Themes
                        </p>
                      )}
                    </Card>
                  </div>
                )}
              </div>
            );
          })()}
        </div>
      </div>
    </div>
  );
};

// ════════════════════════════════════════════════════════════
// MODULE 5: TREND ANALYSIS
// ════════════════════════════════════════════════════════════
const TrendModule = () => {
  const [timeframe, setTimeframe] = useState("week");
  const [comments] = useState(db.get("comments") || []); // eslint-disable-line no-unused-vars

  const generateTrendData = () => {
    const labels = timeframe === "week"
      ? ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]
      : timeframe === "month"
      ? ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
      : ["Q1 2024","Q2 2024","Q3 2024","Q4 2024","Q1 2025","Q2 2025"];
    return labels.map(label => ({
      label,
      positive: Math.floor(Math.random() * 20) + 10,
      negative: Math.floor(Math.random() * 15) + 5,
      neutral: Math.floor(Math.random() * 12) + 3,
    }));
  };

  const [trendData] = useState(generateTrendData());

  const max = Math.max(...trendData.flatMap(d => [d.positive, d.negative, d.neutral])) + 5;
  const barW = 240 / trendData.length; // eslint-disable-line no-unused-vars

  const allComments = db.get("comments") || [];
  const totalPos = allComments.filter(c => c.sentiment === "positive").length;
  const totalNeg = allComments.filter(c => c.sentiment === "negative").length;
  const totalNeu = allComments.filter(c => c.sentiment === "neutral").length;
  const total = allComments.length || 1;

  return (
    <div>
      <SectionTitle icon="trend" title="Trend Analysis" subtitle="Track how sentiment and key themes evolve over time" />
      <div style={{ display:"grid", gridTemplateColumns:"repeat(4,1fr)", gap:16, marginBottom:24 }}>
        <StatCard label="Total Comments" value={allComments.length} color={COLORS.navyLight} />
        <StatCard label="Positive Rate" value={`${Math.round(totalPos/total*100)}%`} color={COLORS.greenLight} />
        <StatCard label="Negative Rate" value={`${Math.round(totalNeg/total*100)}%`} color={COLORS.redLight} />
        <StatCard label="Neutral Rate" value={`${Math.round(totalNeu/total*100)}%`} color={COLORS.amberLight} />
      </div>

      <Card style={{ marginBottom:20 }}>
        <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20 }}>
          <h3 style={{ margin:0, fontSize:16, fontWeight:700, color:COLORS.navy }}>Sentiment Over Time</h3>
          <div style={{ display:"flex", gap:8 }}>
            {[["week","Weekly"],["month","Monthly"],["quarter","Quarterly"]].map(([v, l]) => (
              <button key={v} onClick={() => setTimeframe(v)} style={{
                padding:"6px 14px", borderRadius:6, border:"none", cursor:"pointer", fontSize:12, fontWeight:600,
                background: timeframe === v ? COLORS.navy : COLORS.cream, color: timeframe === v ? COLORS.white : COLORS.slate,
              }}>{l}</button>
            ))}
          </div>
        </div>
        <div style={{ overflowX:"auto", paddingBottom:8 }}>
          <div style={{ minWidth:520 }}>
            <svg width="100%" height={220} viewBox={`0 0 ${trendData.length * 60 + 40} 220`} style={{ overflow:"visible" }}>
              {/* Grid */}
              {[0,25,50,75,100].map(v => (
                <line key={v} x1={40} y1={10 + (1 - v/max) * 180} x2={trendData.length * 60 + 40} y2={10 + (1 - v/max) * 180} stroke="rgba(11,30,61,0.06)" strokeWidth={1} />
              ))}
              {/* Bars */}
              {trendData.map((d, i) => {
                const x = i * 60 + 50;
                const posH = (d.positive / max) * 180;
                const negH = (d.negative / max) * 180;
                const neuH = (d.neutral / max) * 180;
                return (
                  <g key={i}>
                    <rect x={x - 18} y={190 - posH} width={10} height={posH} fill={COLORS.greenLight} rx={3} opacity={0.85} />
                    <rect x={x - 5} y={190 - negH} width={10} height={negH} fill={COLORS.redLight} rx={3} opacity={0.85} />
                    <rect x={x + 8} y={190 - neuH} width={10} height={neuH} fill={COLORS.amberLight} rx={3} opacity={0.85} />
                    <text x={x} y={210} textAnchor="middle" fontSize={10} fill={COLORS.slateLight}>{d.label}</text>
                  </g>
                );
              })}
            </svg>
            <div style={{ display:"flex", gap:20, justifyContent:"center", marginTop:8 }}>
              {[["Positive", COLORS.greenLight], ["Negative", COLORS.redLight], ["Neutral", COLORS.amberLight]].map(([l, c]) => (
                <div key={l} style={{ display:"flex", alignItems:"center", gap:6 }}>
                  <div style={{ width:12, height:12, borderRadius:3, background:c }} />
                  <span style={{ fontSize:12, color:COLORS.slate }}>{l}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </Card>

      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:20 }}>
        <Card>
          <h3 style={{ margin:"0 0 16px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Sentiment Distribution</h3>
          <div style={{ position:"relative", display:"flex", justifyContent:"center", marginBottom:20 }}>
            <svg viewBox="0 0 120 120" width={160} height={160}>
              {(() => {
                const data = [[totalPos, COLORS.greenLight], [totalNeg, COLORS.redLight], [totalNeu, COLORS.amberLight]];
                const total2 = data.reduce((a, [v]) => a + v, 0) || 1;
                let offset = 0;
                return data.map(([v, c], i) => {
                  const pct = v / total2;
                  const angle = pct * 360;
                  const rad = (a) => (a - 90) * Math.PI / 180;
                  const x1 = 60 + 50 * Math.cos(rad(offset));
                  const y1 = 60 + 50 * Math.sin(rad(offset));
                  const x2 = 60 + 50 * Math.cos(rad(offset + angle));
                  const y2 = 60 + 50 * Math.sin(rad(offset + angle));
                  const lg = angle > 180 ? 1 : 0;
                  const path = `M 60 60 L ${x1} ${y1} A 50 50 0 ${lg} 1 ${x2} ${y2} Z`;
                  offset += angle;
                  return <path key={i} d={path} fill={c} opacity={0.85} />;
                });
              })()}
              <circle cx={60} cy={60} r={28} fill={COLORS.white} />
              <text x={60} y={64} textAnchor="middle" fontSize={10} fill={COLORS.navy} fontWeight={700}>{total} total</text>
            </svg>
          </div>
          {[["Positive", totalPos, COLORS.greenLight], ["Negative", totalNeg, COLORS.redLight], ["Neutral", totalNeu, COLORS.amberLight]].map(([l, v, c]) => (
            <div key={l} style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:10 }}>
              <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                <div style={{ width:10, height:10, borderRadius:"50%", background:c }} />
                <span style={{ fontSize:13, color:COLORS.slate }}>{l}</span>
              </div>
              <span style={{ fontSize:14, fontWeight:700, color:COLORS.navy }}>{v} ({Math.round(v/total*100)}%)</span>
            </div>
          ))}
        </Card>
        <Card>
          <h3 style={{ margin:"0 0 16px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Top Issues Over Time</h3>
          {[
            { issue:"Compliance Burden", change:"+12%", trend:"up", color:COLORS.redLight },
            { issue:"Portal Usability", change:"-8%", trend:"down", color:COLORS.greenLight },
            { issue:"Penalty Clarity", change:"+6%", trend:"up", color:COLORS.redLight },
            { issue:"Filing Deadlines", change:"+4%", trend:"up", color:COLORS.amberLight },
            { issue:"Fee Structure", change:"-3%", trend:"down", color:COLORS.greenLight },
          ].map(({ issue, change, trend, color }) => (
            <div key={issue} style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:12, padding:"10px 12px", borderRadius:8, background:COLORS.cream }}>
              <span style={{ fontSize:14, color:COLORS.navy }}>{issue}</span>
              <span style={{ fontSize:13, fontWeight:700, color }}>{trend === "up" ? "↑" : "↓"} {change}</span>
            </div>
          ))}
        </Card>
      </div>
    </div>
  );
};

// ════════════════════════════════════════════════════════════
// ADMIN PANEL
// ════════════════════════════════════════════════════════════
const AdminPanel = ({ currentUser }) => {
  const [users, setUsers] = useState(db.get("users") || []);
  const [comments, setComments] = useState(db.get("comments") || []);
  const [newUser, setNewUser] = useState({ name:"", email:"", password:"", role:"individual" });
  const [msg, setMsg] = useState(null);

  const addUser = () => {
    if (!newUser.name || !newUser.email || !newUser.password) return;
    if (users.find(u => u.email === newUser.email)) {
      setMsg({ type:"error", text:"Email already exists!" });
      setTimeout(() => setMsg(null), 3000);
      return;
    }
    const updated = [...users, { ...newUser, id: Date.now() }];
    db.set("users", updated);
    setUsers(updated);
    setNewUser({ name:"", email:"", password:"", role:"individual" });
    setMsg({ type:"success", text:"User created successfully!" });
    setTimeout(() => setMsg(null), 3000);
  };

  const deleteUser = (id) => {
    const u = users.find(x => x.id === id);
    if (!window.confirm(`Delete user "${u?.name || u?.email}"? This cannot be undone.`)) return;
    const updated = users.filter(x => x.id !== id);
    db.set("users", updated);
    setUsers(updated);
    setMsg({ type:"success", text:"User deleted." });
    setTimeout(() => setMsg(null), 2000);
  };

  const changeRole = (id, newRole) => {
    const updated = users.map(u => u.id === id ? { ...u, role: newRole } : u);
    db.set("users", updated);
    setUsers(updated);
    setMsg({ type:"success", text:"Role updated!" });
    setTimeout(() => setMsg(null), 2000);
  };

  const deleteComment = (id) => {
    if (!window.confirm('Delete this comment? This cannot be undone.')) return;
    const updated = comments.filter(c => c.id !== id);
    db.set('comments', updated);
    setComments(updated);
    setMsg({ type:'success', text:'Comment deleted.' });
    setTimeout(() => setMsg(null), 2000);
  };

  const deleteAllComments = () => {
    if (!window.confirm('Delete ALL ' + comments.length + ' comments? This cannot be undone.')) return;
    db.set('comments', []);
    setComments([]);
    setMsg({ type:'success', text:'All comments cleared.' });
    setTimeout(() => setMsg(null), 2000);
  };

  return (
    <div>
      <SectionTitle icon="users" title="Admin Panel" subtitle="Manage users, monitor activity, and review feedback" />
      {msg && (
        <div style={{ padding:"12px 16px", borderRadius:8, background: msg.type === "success" ? "rgba(26,107,74,0.1)" : "rgba(192,57,43,0.1)", color: msg.type === "success" ? COLORS.green : COLORS.red, marginBottom:20, fontSize:14 }}>{msg.text}</div>
      )}
      <div style={{ display:"grid", gridTemplateColumns:"repeat(4,1fr)", gap:16, marginBottom:24 }}>
        <StatCard label="Total Users" value={users.length} color={COLORS.navyLight} />
        <StatCard label="Total Comments" value={comments.length} color={COLORS.gold} />
        <StatCard label="Business Users" value={users.filter(u => u.role === "business").length} color={COLORS.amberLight} />
        <StatCard label="Admins" value={users.filter(u => u.role === "admin").length} color={COLORS.greenLight} />
      </div>

      <div style={{ display:"grid", gridTemplateColumns:"1fr 1.5fr", gap:20, marginBottom:24 }}>
        <Card>
          <h3 style={{ margin:"0 0 16px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Create New User</h3>
          {[["Name","name","text"],["Email","email","email"],["Password","password","password"]].map(([label, field, type]) => (
            <div key={field} style={{ marginBottom:12 }}>
              <label style={{ display:"block", fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:4, textTransform:"uppercase", letterSpacing:0.5 }}>{label}</label>
              <input type={type} value={newUser[field]} onChange={e => setNewUser(p => ({...p, [field]: e.target.value}))}
                style={{ width:"100%", padding:"10px 12px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:13, outline:"none", color:COLORS.navy, boxSizing:"border-box" }} />
            </div>
          ))}
          <div style={{ marginBottom:16 }}>
            <label style={{ display:"block", fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:4, textTransform:"uppercase", letterSpacing:0.5 }}>Role</label>
            <select value={newUser.role} onChange={e => setNewUser(p => ({...p, role: e.target.value}))} style={{ width:"100%", padding:"10px 12px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:13, outline:"none", color:COLORS.navy }}>
              <option value="individual">Individual</option>
              <option value="business">Business</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <button onClick={addUser} style={{
            width:"100%", padding:"11px", borderRadius:8, border:"none",
            background: COLORS.navy, color:COLORS.white, fontSize:14, fontWeight:700, cursor:"pointer",
          }}>Create User</button>
        </Card>
        <Card>
          <h3 style={{ margin:"0 0 16px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Users ({users.length})</h3>
          <div style={{ maxHeight:380, overflowY:"auto" }}>
            <table style={{ width:"100%", borderCollapse:"collapse", fontSize:13 }}>
              <thead>
                <tr style={{ background:COLORS.cream, position:"sticky", top:0 }}>
                  {["Name","Email","Role","Actions"].map(h => (
                    <th key={h} style={{ padding:"10px 12px", textAlign:"left", color:COLORS.navy, fontWeight:700, fontSize:11, textTransform:"uppercase", letterSpacing:0.5 }}>{h}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {users.map(u => (
                  <tr key={u.id} style={{ borderBottom:"1px solid rgba(11,30,61,0.06)" }}>
                    <td style={{ padding:"10px 12px", color:COLORS.navy, fontWeight:600 }}>{u.name}</td>
                    <td style={{ padding:"10px 12px", color:COLORS.slate, fontSize:12 }}>{u.email}</td>
                    <td style={{ padding:"10px 12px" }}>
                      <select
                        value={u.role}
                        onChange={e => changeRole(u.id, e.target.value)}
                        style={{
                          padding:"5px 8px", borderRadius:6, fontSize:12, fontWeight:600, cursor:"pointer",
                          border:"1.5px solid rgba(11,30,61,0.15)", outline:"none",
                          background: u.role === "admin" ? "rgba(11,30,61,0.08)" : u.role === "business" ? "rgba(183,119,13,0.08)" : "rgba(74,85,104,0.08)",
                          color: u.role === "admin" ? COLORS.navy : u.role === "business" ? COLORS.amber : COLORS.slate,
                        }}>
                        <option value="individual">Individual</option>
                        <option value="business">Business</option>
                        <option value="admin">Admin</option>
                      </select>
                    </td>
                    <td style={{ padding:"10px 12px" }}>
                      <button onClick={() => deleteUser(u.id)} title="Delete user" style={{
                        padding:"6px 12px", borderRadius:7, border:"1.5px solid " + COLORS.redLight,
                        background:"rgba(231,76,60,0.08)", color:COLORS.redLight,
                        fontSize:12, fontWeight:700, cursor:"pointer",
                      }}>🗑 Delete</button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </Card>
      </div>

      <Card>
        <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:16 }}>
          <h3 style={{ margin:0, fontSize:15, fontWeight:700, color:COLORS.navy }}>Comments ({comments.length})</h3>
          {comments.length > 0 && (
            <button onClick={deleteAllComments} style={{
              padding:"7px 14px", borderRadius:7, border:"1.5px solid " + COLORS.red,
              background:"rgba(192,57,43,0.07)", color:COLORS.red, fontSize:12,
              fontWeight:700, cursor:"pointer",
            }}>🗑 Delete All</button>
          )}
        </div>
        {comments.length === 0 && (
          <p style={{ color:COLORS.slateLight, fontSize:13, textAlign:"center", padding:"32px 0" }}>No comments yet.</p>
        )}
        <div style={{ maxHeight:380, overflowY:"auto", display:"grid", gap:10 }}>
          {comments.map(c => (
            <div key={c.id} style={{ padding:"12px 14px", borderRadius:8, background:COLORS.cream, display:"grid", gridTemplateColumns:"1fr auto", gap:12, alignItems:"center", borderLeft:"3px solid " + (c.sentiment==="positive" ? COLORS.greenLight : c.sentiment==="negative" ? COLORS.redLight : COLORS.slateLight) }}>
              <div>
                <p style={{ margin:"0 0 6px", fontSize:13, color:COLORS.navy, lineHeight:1.5 }}>{c.text.slice(0,130)}{c.text.length > 130 ? "..." : ""}</p>
                <div style={{ display:"flex", gap:10, fontSize:12, color:COLORS.slateLight, alignItems:"center" }}>
                  <span>{c.user || "Anonymous"}</span>
                  <span>·</span>
                  <SentimentBadge s={c.sentiment} />
                  <span>·</span>
                  <span style={{ fontSize:11 }}>{new Date(c.createdAt).toLocaleDateString("en-IN")}</span>
                </div>
              </div>
              <button onClick={() => deleteComment(c.id)} title="Delete comment" style={{
                padding:"7px 12px", borderRadius:7, border:"1.5px solid " + COLORS.redLight,
                background:"rgba(231,76,60,0.08)", color:COLORS.redLight,
                fontSize:12, fontWeight:700, cursor:"pointer", whiteSpace:"nowrap",
              }}>🗑 Delete</button>
            </div>
          ))}
        </div>
      </Card>
    </div>
  );
};

// ════════════════════════════════════════════════════════════
// DASHBOARD HOME
// ════════════════════════════════════════════════════════════
const DashboardHome = ({ user, setActiveModule }) => {
  const comments = db.get("comments") || [];
  const pos = comments.filter(c => c.sentiment === "positive").length;
  const neg = comments.filter(c => c.sentiment === "negative").length;
  const neu = comments.filter(c => c.sentiment === "neutral").length;

  const modules = [
    { id:"wordcloud", icon:"cloud", title:"Word Cloud", desc:"Visualize key themes & patterns from public feedback", color:COLORS.navyLight },
    { id:"akashwani", icon:"policy", title:"Akashwani Policy Analyzer", desc:"ML/AI scoring of policy draft acceptance rates", color:COLORS.gold },
    { id:"sentiment", icon:"brain", title:"Sentiment Analysis", desc:"Classify and analyze consultation comment sentiments", color:COLORS.greenLight },
    { id:"summary", icon:"file", title:"Summary Generator", desc:"AI-generated narrative summaries from feedback", color:COLORS.amberLight },
    { id:"trend", icon:"trend", title:"Trend Analysis", desc:"Track sentiment trends over time with visualizations", color:COLORS.redLight },
  ];

  return (
    <div>
      <div style={{ marginBottom:32 }}>
        <h2 style={{ margin:"0 0 6px", fontSize:26, fontWeight:800, color:COLORS.navy, fontFamily:"Georgia, serif" }}>
          Welcome back, {user.name.split(" ")[0]} 👋
        </h2>
        <p style={{ margin:0, color:COLORS.slateLight, fontSize:15 }}>MCA E-Consultation Dashboard · MANOBHAV Platform</p>
      </div>
      <div style={{ display:"grid", gridTemplateColumns:"repeat(4,1fr)", gap:16, marginBottom:28 }}>
        <StatCard label="Total Comments" value={comments.length} color={COLORS.navyLight} />
        <StatCard label="Positive" value={pos} color={COLORS.greenLight} />
        <StatCard label="Negative" value={neg} color={COLORS.redLight} />
        <StatCard label="Neutral" value={neu} color={COLORS.amberLight} />
      </div>
      <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:20, marginBottom:24 }}>
        {modules.map(m => (
          <div key={m.id} onClick={() => setActiveModule(m.id)} style={{
            background:COLORS.white, borderRadius:14, padding:"24px 20px", cursor:"pointer",
            boxShadow:"0 2px 16px rgba(11,30,61,0.07)",
            borderTop:`4px solid ${m.color}`,
            transition:"transform 0.15s, box-shadow 0.15s",
          }}
            onMouseEnter={e => { e.currentTarget.style.transform = "translateY(-4px)"; e.currentTarget.style.boxShadow = "0 8px 28px rgba(11,30,61,0.13)"; }}
            onMouseLeave={e => { e.currentTarget.style.transform = ""; e.currentTarget.style.boxShadow = "0 2px 16px rgba(11,30,61,0.07)"; }}
          >
            <div style={{ color:m.color, marginBottom:12 }}><Icon name={m.icon} size={28} /></div>
            <h3 style={{ margin:"0 0 8px", fontSize:15, fontWeight:800, color:COLORS.navy }}>{m.title}</h3>
            <p style={{ margin:0, fontSize:13, color:COLORS.slateLight, lineHeight:1.5 }}>{m.desc}</p>
          </div>
        ))}
        <div style={{ background:COLORS.cream, borderRadius:14, padding:"24px 20px", borderTop:`4px solid ${COLORS.slateLight}`, display:"flex", flexDirection:"column", justifyContent:"center", alignItems:"center", color:COLORS.slateLight }}>
          <Icon name="chart" size={28} />
          <p style={{ margin:"12px 0 0", fontSize:13, textAlign:"center" }}>More modules coming soon</p>
        </div>
      </div>
      <Card>
        <h3 style={{ margin:"0 0 16px", fontSize:15, fontWeight:700, color:COLORS.navy }}>Recent Feedback Activity</h3>
        <div style={{ display:"grid", gap:10 }}>
          {comments.slice(-5).reverse().map(c => (
            <div key={c.id} style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 14px", borderRadius:8, background:COLORS.cream }}>
              <div>
                <p style={{ margin:0, fontSize:13, color:COLORS.navy }}>{c.text.slice(0,80)}...</p>
                <span style={{ fontSize:12, color:COLORS.slateLight }}>{c.user} · {new Date(c.createdAt).toLocaleDateString()}</span>
              </div>
              <SentimentBadge s={c.sentiment} />
            </div>
          ))}
        </div>
      </Card>
    </div>
  );
};

// ════════════════════════════════════════════════════════════
// AUTH SCREEN
// ════════════════════════════════════════════════════════════
const AuthScreen = ({ onLogin }) => {
  const [mode, setMode] = useState("login");
  const [form, setForm] = useState({ name:"", email:"admin@manobhav.gov.in", password:"admin123", role:"individual" });
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  const handle = async (e) => {
    e.preventDefault();
    setError(""); setLoading(true);
    await new Promise(r => setTimeout(r, 600));
    const users = db.get("users") || [];
    if (mode === "login") {
      const u = users.find(u => u.email === form.email && u.password === form.password);
      if (u) { db.set("session", u); onLogin(u); }
      else setError("Invalid email or password.");
    } else {
      if (users.find(u => u.email === form.email)) { setError("Email already registered."); }
      else {
        const newU = { ...form, id: Date.now() };
        const updated = [...users, newU];
        db.set("users", updated);
        db.set("session", newU);
        onLogin(newU);
      }
    }
    setLoading(false);
  };

  return (
    <div style={{ minHeight:"100vh", background:`linear-gradient(135deg, ${COLORS.navy} 0%, ${COLORS.navyLight} 50%, ${COLORS.navyMid} 100%)`, display:"flex", alignItems:"center", justifyContent:"center", padding:20, fontFamily:"'Georgia', serif" }}>
      <style>{`@keyframes spin { to { transform: rotate(360deg); } } @keyframes fadeUp { from { opacity:0; transform:translateY(24px); } to { opacity:1; transform:translateY(0); } }`}</style>
      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:0, maxWidth:900, width:"100%", borderRadius:20, overflow:"hidden", boxShadow:"0 30px 80px rgba(0,0,0,0.4)", animation:"fadeUp 0.5s ease" }}>
        {/* Left brand panel */}
        <div style={{ background:`linear-gradient(160deg, ${COLORS.navyMid} 0%, ${COLORS.navy} 100%)`, padding:"48px 40px", color:COLORS.white, borderRight:`1px solid rgba(201,168,76,0.2)` }}>
          <div style={{ fontSize:11, fontWeight:700, letterSpacing:3, color:COLORS.gold, marginBottom:20, textTransform:"uppercase", opacity:0.8 }}>Ministry of Corporate Affairs</div>
          <div style={{ marginBottom:16 }}>
            <ButterflyLogo size={56} showText={false} />
          </div>
          <h1 style={{ fontSize:34, fontWeight:400, margin:"0 0 4px", fontFamily:"Georgia, serif", lineHeight:1.2, color:COLORS.gold, letterSpacing:2 }}>MANOBHAV</h1>
          <div style={{ fontSize:13, color:"rgba(201,168,76,0.75)", marginBottom:28, fontFamily:"Georgia, serif", fontStyle:"italic", letterSpacing:1 }}>— The Akashvani Predictor —</div>
          <div style={{ fontSize:13, color:"rgba(255,255,255,0.65)", marginBottom:24, fontFamily:"sans-serif", lineHeight:1.7 }}>AI-powered MCA public consultation analysis platform</div>
          <div style={{ fontSize:13, color:"rgba(255,255,255,0.75)", lineHeight:1.8, fontFamily:"sans-serif", marginBottom:32 }}>
            Analyze public consultation feedback using AI-powered sentiment analysis, word clouds, policy scoring, and trend visualization.
          </div>
          <div style={{ display:"flex", flexDirection:"column", gap:12 }}>
            {[
              ["cloud", "Word Cloud Analyzer"],
              ["policy", "Akashwani Policy Scorer"],
              ["brain", "Sentiment Analysis"],
              ["file", "AI Summary Generator"],
              ["trend", "Trend Analysis"],
            ].map(([icon, label]) => (
              <div key={label} style={{ display:"flex", alignItems:"center", gap:10, fontSize:14, color:"rgba(255,255,255,0.85)", fontFamily:"sans-serif" }}>
                <div style={{ color:COLORS.gold }}><Icon name={icon} size={16} /></div> {label}
              </div>
            ))}
          </div>
          <div style={{ marginTop:32, padding:"14px 16px", borderRadius:10, background:"rgba(201,168,76,0.1)", border:`1px solid rgba(201,168,76,0.3)` }}>
            <div style={{ fontSize:12, fontWeight:700, color:COLORS.gold, marginBottom:6, fontFamily:"sans-serif", letterSpacing:0.5, textTransform:"uppercase" }}>Demo Credentials</div>
            <div style={{ fontSize:13, color:"rgba(255,255,255,0.8)", fontFamily:"monospace" }}>admin@manobhav.gov.in</div>
            <div style={{ fontSize:13, color:"rgba(255,255,255,0.8)", fontFamily:"monospace" }}>admin123</div>
          </div>
        </div>
        {/* Right auth panel */}
        <div style={{ background:COLORS.white, padding:"48px 40px" }}>
          <h2 style={{ margin:"0 0 4px", fontSize:24, fontWeight:700, color:COLORS.navy }}>
            {mode === "login" ? "Sign in" : "Create account"}
          </h2>
          <p style={{ margin:"0 0 28px", fontSize:14, color:COLORS.slateLight, fontFamily:"sans-serif" }}>
            {mode === "login" ? "Access your MANOBHAV dashboard" : "Register for MCA e-consultation"}
          </p>
          {error && <div style={{ padding:"10px 14px", borderRadius:8, background:"rgba(192,57,43,0.08)", color:COLORS.red, fontSize:13, marginBottom:16, fontFamily:"sans-serif" }}>{error}</div>}
          <form onSubmit={handle} style={{ fontFamily:"sans-serif" }}>
            {mode === "register" && (
              <div style={{ marginBottom:14 }}>
                <label style={{ display:"block", fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:5, textTransform:"uppercase", letterSpacing:0.5 }}>Full Name</label>
                <input type="text" required value={form.name} onChange={e => setForm(p => ({...p, name:e.target.value}))}
                  style={{ width:"100%", padding:"11px 14px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:14, outline:"none", color:COLORS.navy, boxSizing:"border-box" }} />
              </div>
            )}
            <div style={{ marginBottom:14 }}>
              <label style={{ display:"block", fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:5, textTransform:"uppercase", letterSpacing:0.5 }}>Email</label>
              <input type="email" required value={form.email} onChange={e => setForm(p => ({...p, email:e.target.value}))}
                style={{ width:"100%", padding:"11px 14px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:14, outline:"none", color:COLORS.navy, boxSizing:"border-box" }} />
            </div>
            <div style={{ marginBottom:mode === "register" ? 14 : 20 }}>
              <label style={{ display:"block", fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:5, textTransform:"uppercase", letterSpacing:0.5 }}>Password</label>
              <input type="password" required value={form.password} onChange={e => setForm(p => ({...p, password:e.target.value}))}
                style={{ width:"100%", padding:"11px 14px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:14, outline:"none", color:COLORS.navy, boxSizing:"border-box" }} />
            </div>
            {mode === "register" && (
              <div style={{ marginBottom:20 }}>
                <label style={{ display:"block", fontSize:12, fontWeight:700, color:COLORS.slateLight, marginBottom:5, textTransform:"uppercase", letterSpacing:0.5 }}>Account Type</label>
                <select value={form.role} onChange={e => setForm(p => ({...p, role:e.target.value}))}
                  style={{ width:"100%", padding:"11px 14px", borderRadius:8, border:"1.5px solid rgba(11,30,61,0.15)", fontSize:14, outline:"none", color:COLORS.navy }}>
                  <option value="individual">Individual Citizen</option>
                  <option value="business">Business / Corporate</option>
                </select>
              </div>
            )}
            <button type="submit" disabled={loading} style={{
              width:"100%", padding:"13px", borderRadius:10, border:"none",
              background: loading ? COLORS.slateLight : `linear-gradient(135deg, ${COLORS.navy}, ${COLORS.navyLight})`,
              color:COLORS.white, fontSize:15, fontWeight:700, cursor: loading ? "not-allowed" : "pointer",
              display:"flex", alignItems:"center", justifyContent:"center", gap:10,
            }}>
              {loading ? <><Spinner size={18} /> Please wait...</> : mode === "login" ? "Sign In" : "Create Account"}
            </button>
          </form>
          <div style={{ textAlign:"center", marginTop:20, fontFamily:"sans-serif" }}>
            <button onClick={() => { setMode(mode === "login" ? "register" : "login"); setError(""); }} style={{
              background:"none", border:"none", color:COLORS.gold, fontSize:14, cursor:"pointer", fontWeight:600,
            }}>
              {mode === "login" ? "Don't have an account? Register" : "Already registered? Sign in"}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

// ════════════════════════════════════════════════════════════
// MAIN APP SHELL
// ════════════════════════════════════════════════════════════
export default function App() {
  const [user, setUser] = useState(() => db.get("session"));
  const [activeModule, setActiveModule] = useState("home");
  const [sidebarOpen, setSidebarOpen] = useState(true);

  const logout = () => { localStorage.removeItem("manobhav_session"); setUser(null); setActiveModule("home"); };

  if (!user) return <AuthScreen onLogin={u => setUser(u)} />;

  const navItems = [
    { id:"home", icon:"home", label:"Dashboard" },
    { id:"wordcloud", icon:"cloud", label:"Word Cloud" },
    { id:"akashwani", icon:"policy", label:"Akashwani" },
    { id:"sentiment", icon:"brain", label:"Sentiment" },
    { id:"summary", icon:"file", label:"Summary" },
    { id:"trend", icon:"trend", label:"Trends" },
    ...(user.role === "admin" ? [{ id:"admin", icon:"users", label:"Admin" }] : []),
  ];

  const renderModule = () => {
    switch (activeModule) {
      case "home": return <DashboardHome user={user} setActiveModule={setActiveModule} />;
      case "wordcloud": return <WordCloudModule />;
      case "akashwani": return <AkashwaniModule />;
      case "sentiment": return <SentimentModule />;
      case "summary": return <SummaryModule />;
      case "trend": return <TrendModule />;
      case "admin": return user.role === "admin" ? <AdminPanel currentUser={user} /> : null;
      default: return null;
    }
  };

  return (
    <div style={{ display:"flex", minHeight:"100vh", background:COLORS.pageBg, fontFamily:"sans-serif" }}>
      <style>{`@keyframes spin { to { transform: rotate(360deg); } } * { box-sizing: border-box; } ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(11,30,61,0.15); border-radius: 3px; }`}</style>
      {/* SIDEBAR */}
      <div style={{
        width: sidebarOpen ? 220 : 64, minHeight:"100vh",
        background: COLORS.navy,
        transition:"width 0.25s ease",
        display:"flex", flexDirection:"column",
        flexShrink:0, overflow:"hidden",
        boxShadow:"2px 0 20px rgba(0,0,0,0.15)",
      }}>
        {/* Logo */}
        <div style={{ padding:"16px 14px", borderBottom:`1px solid rgba(201,168,76,0.15)`, display:"flex", alignItems:"center", gap:10, overflow:"hidden" }}>
          <div style={{ flexShrink:0 }}>
            <ButterflyLogo size={sidebarOpen ? 42 : 36} showText={false} />
          </div>
          {sidebarOpen && (
            <div>
              <div style={{ fontFamily:"Georgia, serif", fontWeight:800, color:COLORS.gold, whiteSpace:"nowrap", fontSize:15, letterSpacing:1 }}>MANOBHAV</div>
              <div style={{ fontSize:9, color:"rgba(201,168,76,0.65)", whiteSpace:"nowrap", letterSpacing:1.5, textTransform:"uppercase" }}>The Akashvani Predictor</div>
            </div>
          )}
        </div>
        {/* Nav items */}
        <nav style={{ flex:1, padding:"12px 8px" }}>
          {navItems.map(item => (
            <button key={item.id} onClick={() => setActiveModule(item.id)} style={{
              width:"100%", display:"flex", alignItems:"center", gap:12, padding:"11px 12px",
              borderRadius:10, border:"none", cursor:"pointer", textAlign:"left", marginBottom:2,
              background: activeModule === item.id ? "rgba(201,168,76,0.18)" : "transparent",
              color: activeModule === item.id ? COLORS.gold : "rgba(255,255,255,0.7)",
              transition:"all 0.15s", overflow:"hidden",
            }}
              onMouseEnter={e => { if (activeModule !== item.id) e.currentTarget.style.background = "rgba(255,255,255,0.06)"; }}
              onMouseLeave={e => { if (activeModule !== item.id) e.currentTarget.style.background = "transparent"; }}
            >
              <div style={{ flexShrink:0 }}><Icon name={item.icon} size={18} /></div>
              {sidebarOpen && <span style={{ fontSize:13, fontWeight:600, whiteSpace:"nowrap" }}>{item.label}</span>}
              {activeModule === item.id && sidebarOpen && <div style={{ marginLeft:"auto", width:4, height:4, borderRadius:"50%", background:COLORS.gold }} />}
            </button>
          ))}
        </nav>
        {/* User & logout */}
        <div style={{ padding:"12px 8px", borderTop:`1px solid rgba(255,255,255,0.08)` }}>
          {sidebarOpen && (
            <div style={{ padding:"10px 12px", borderRadius:10, background:"rgba(255,255,255,0.05)", marginBottom:8 }}>
              <div style={{ fontSize:13, fontWeight:600, color:COLORS.white, whiteSpace:"nowrap", overflow:"hidden", textOverflow:"ellipsis" }}>{user.name}</div>
              <div style={{ fontSize:11, color:"rgba(255,255,255,0.5)", textTransform:"capitalize" }}>{user.role}</div>
            </div>
          )}
          <button onClick={() => setSidebarOpen(p => !p)} style={{
            width:"100%", display:"flex", alignItems:"center", justifyContent: sidebarOpen ? "flex-start" : "center", gap:10,
            padding:"10px 12px", borderRadius:8, border:"none", background:"transparent", cursor:"pointer", color:"rgba(255,255,255,0.5)", marginBottom:4,
          }}><Icon name="menu" size={16} /></button>
          <button onClick={logout} style={{
            width:"100%", display:"flex", alignItems:"center", justifyContent: sidebarOpen ? "flex-start" : "center", gap:10,
            padding:"10px 12px", borderRadius:8, border:"none", background:"transparent", cursor:"pointer", color:"rgba(255,255,255,0.5)",
          }}>
            <Icon name="logout" size={16} />
            {sidebarOpen && <span style={{ fontSize:13, fontWeight:600, whiteSpace:"nowrap" }}>Sign Out</span>}
          </button>
        </div>
      </div>
      {/* MAIN CONTENT */}
      <div style={{ flex:1, overflow:"auto", minWidth:0 }}>
        {/* Top bar */}
        <div style={{ background:COLORS.white, padding:"14px 28px", borderBottom:"1px solid rgba(11,30,61,0.06)", display:"flex", justifyContent:"space-between", alignItems:"center", position:"sticky", top:0, zIndex:10 }}>
          <div>
            <div style={{ fontSize:18, fontWeight:800, color:COLORS.navy, fontFamily:"Georgia, serif" }}>
              {navItems.find(n => n.id === activeModule)?.label || "Dashboard"}
            </div>
          </div>
          <div style={{ display:"flex", alignItems:"center", gap:12 }}>
            <Badge label={user.role} color={user.role === "admin" ? COLORS.navy : COLORS.amber} bg={user.role === "admin" ? "rgba(11,30,61,0.08)" : "rgba(183,119,13,0.1)"} />
            <div style={{ fontSize:14, fontWeight:600, color:COLORS.navy }}>{user.name}</div>
          </div>
        </div>
        {/* Page content */}
        <div style={{ padding:"28px 32px", maxWidth:1280, margin:"0 auto" }}>
          {renderModule()}
        </div>
      </div>
    </div>
  );
}